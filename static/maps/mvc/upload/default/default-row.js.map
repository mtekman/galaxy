{"version":3,"sources":["mvc/upload/default/default-row.js"],"names":["define","status_classes","init","running","UploadSettings","Popover","Select","success","View","extend","initialize","self","app","error","options","$text","this","$size","$info_text","model","$info_progress","_template","$text_content","$","$settings","$symbol","$progress_bar","$percentage","settings","title","container","placement","default_genome","default_extension","data","list_genomes","select_genome","value","select_extension","genome","css","set","extension","list_extensions","_removeRow","showExtensionInfo","$el","on","preventDefault","e","target","text","url_paste","file_size","listenTo","_refreshStatus","val","length","_refreshGenome","_refreshPercentage","_refreshExtension","_refreshFileSize","_refreshInfo","render","_refreshType","Backbone","remove","$mode","prototype","apply","height","addClass","attributes","$title","file_mode","file_name","bytesToString","width","top","show","get","percentage","status","enabled","info","enable","parseInt","html","removeClass","indexOf","attr","_showSettings","disable","append","hide","Utils","collection","visible","empty","id"],"mappings":"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","file":"../../../../scripts/mvc/upload/default/default-row.js","sourcesContent":["/** Renders the default uploader rows */\ndefine(\n    [\n        \"utils/utils\",\n        \"mvc/upload/upload-model\",\n        \"mvc/upload/upload-settings\",\n        \"mvc/ui/ui-popover\",\n        \"mvc/ui/ui-select\"\n    ],\n    function(Utils, UploadModel, UploadSettings, Popover, Select) {\n        return Backbone.View.extend({\n            /** Dictionary of upload states and associated icons */\n            status_classes: {\n                init: \"upload-icon-button fa fa-trash-o\",\n                queued: \"upload-icon fa fa-spinner fa-spin\",\n                running: \"upload-icon fa fa-spinner fa-spin\",\n                success: \"upload-icon-button fa fa-check\",\n                error: \"upload-icon-button fa fa-exclamation-triangle\"\n            },\n\n            initialize: function(app, options) {\n                var self = this;\n                this.app = app;\n                this.model = options.model;\n                this.setElement(this._template(options.model));\n                this.$mode = this.$(\".upload-mode\");\n                this.$title = this.$(\".upload-title\");\n                this.$text = this.$(\".upload-text\");\n                this.$size = this.$(\".upload-size\");\n                this.$info_text = this.$(\".upload-info-text\");\n                this.$info_progress = this.$(\".upload-info-progress\");\n                this.$text_content = this.$(\".upload-text-content\");\n                this.$settings = this.$(\".upload-settings\");\n                this.$symbol = this.$(\".upload-symbol\");\n                this.$progress_bar = this.$(\".upload-progress-bar\");\n                this.$percentage = this.$(\".upload-percentage\");\n\n                // append popup to settings icon\n                this.settings = new Popover.View({\n                    title: \"Upload configuration\",\n                    container: this.$(\".upload-settings\"),\n                    placement: \"bottom\"\n                });\n\n                // identify default genome and extension values\n                var default_genome = this.app.select_genome.value();\n                var default_extension = this.app.select_extension.value();\n\n                // create select genomes\n                this.select_genome = new Select.View({\n                    css: \"upload-genome\",\n                    data: self.app.list_genomes,\n                    container: this.$(\".upload-genome\"),\n                    value: default_genome,\n                    onchange: function(genome) {\n                        self.model.set(\"genome\", genome);\n                    }\n                });\n\n                // create select extension\n                this.select_extension = new Select.View({\n                    css: \"upload-extension\",\n                    data: self.app.list_extensions,\n                    container: this.$(\".upload-extension\"),\n                    value: default_extension,\n                    onchange: function(extension) {\n                        self.model.set(\"extension\", extension);\n                    }\n                });\n\n                // initialize genome and extension values\n                this.model.set({\n                    genome: default_genome,\n                    extension: default_extension\n                });\n\n                // handle click event\n                this.$symbol.on(\"click\", function() {\n                    self._removeRow();\n                });\n\n                // handle extension info popover\n                this.$(\".upload-extension-info\")\n                    .on(\"click\", function(e) {\n                        self.app.showExtensionInfo({\n                            $el: $(e.target),\n                            title: self.select_extension.text(),\n                            extension: self.select_extension.value()\n                        });\n                    })\n                    .on(\"mousedown\", function(e) {\n                        e.preventDefault();\n                    });\n\n                // handle settings popover\n                this.$settings\n                    .on(\"click\", function(e) {\n                        self._showSettings();\n                    })\n                    .on(\"mousedown\", function(e) {\n                        e.preventDefault();\n                    });\n\n                // handle text editing event\n                this.$text_content.on(\"change input\", function(e) {\n                    self.model.set({\n                        url_paste: $(e.target).val(),\n                        file_size: $(e.target).val().length\n                    });\n                });\n\n                // model events\n                this.listenTo(this.model, \"change:percentage\", function() {\n                    self._refreshPercentage();\n                });\n                this.listenTo(this.model, \"change:status\", function() {\n                    self._refreshStatus();\n                });\n                this.listenTo(this.model, \"change:info\", function() {\n                    self._refreshInfo();\n                });\n                this.listenTo(this.model, \"change:genome\", function() {\n                    self._refreshGenome();\n                });\n                this.listenTo(this.model, \"change:extension\", function() {\n                    self._refreshExtension();\n                });\n                this.listenTo(this.model, \"change:file_size\", function() {\n                    self._refreshFileSize();\n                });\n            },\n\n            render: function() {\n                this._refreshType();\n                this._refreshPercentage();\n                this._refreshStatus();\n                this._refreshInfo();\n                this._refreshGenome();\n                this._refreshExtension();\n                this._refreshFileSize();\n            },\n\n            /** Remove view */\n            remove: function() {\n                this.select_genome.remove();\n                this.select_extension.remove();\n                Backbone.View.prototype.remove.apply(this);\n            },\n\n            /** Render type */\n            _refreshType: function() {\n                var options = this.model.attributes;\n                this.$title.html(_.escape(options.file_name));\n                this.$size.html(Utils.bytesToString(options.file_size));\n                this.$mode\n                    .removeClass()\n                    .addClass(\"upload-mode\")\n                    .addClass(\"text-primary\");\n                if (options.file_mode == \"new\") {\n                    this.$text\n                        .css({\n                            width: this.$el.width() - 16 + \"px\",\n                            top: this.$el.height() - 8 + \"px\"\n                        })\n                        .show();\n                    this.$el.height(\n                        this.$el.height() - 8 + this.$text.height() + 16\n                    );\n                    this.$mode.addClass(\"fa fa-edit\");\n                } else if (options.file_mode == \"local\") {\n                    this.$mode.addClass(\"fa fa-laptop\");\n                } else if (options.file_mode == \"ftp\") {\n                    this.$mode.addClass(\"fa fa-folder-open-o\");\n                }\n            },\n\n            /** Update extension */\n            _refreshExtension: function() {\n                this.select_extension.value(this.model.get(\"extension\"));\n            },\n\n            /** Update genome */\n            _refreshGenome: function() {\n                this.select_genome.value(this.model.get(\"genome\"));\n            },\n\n            /** Refresh info text */\n            _refreshInfo: function() {\n                var info = this.model.get(\"info\");\n                if (info) {\n                    this.$info_text\n                        .html(\"<strong>Failed: </strong>\" + info)\n                        .show();\n                } else {\n                    this.$info_text.hide();\n                }\n            },\n\n            /** Refresh percentage status */\n            _refreshPercentage: function() {\n                var percentage = parseInt(this.model.get(\"percentage\"));\n                this.$progress_bar.css({ width: percentage + \"%\" });\n                this.$percentage.html(\n                    percentage != 100\n                        ? percentage + \"%\"\n                        : \"Adding to history...\"\n                );\n            },\n\n            /** Refresh status */\n            _refreshStatus: function() {\n                var status = this.model.get(\"status\");\n                this.$symbol\n                    .removeClass()\n                    .addClass(\"upload-symbol\")\n                    .addClass(this.status_classes[status]);\n                this.model.set(\"enabled\", status == \"init\");\n                var enabled = this.model.get(\"enabled\");\n                this.$text_content.attr(\"disabled\", !enabled);\n                if (enabled) {\n                    this.select_genome.enable();\n                    this.select_extension.enable();\n                } else {\n                    this.select_genome.disable();\n                    this.select_extension.disable();\n                }\n                if (status == \"success\") {\n                    this.$el.addClass(\"success\");\n                    this.$percentage.html(\"100%\");\n                }\n                if (status == \"error\") {\n                    this.$el.addClass(\"danger\");\n                    this.$info_progress.hide();\n                }\n            },\n\n            /** Refresh file size */\n            _refreshFileSize: function() {\n                this.$size.html(\n                    Utils.bytesToString(this.model.get(\"file_size\"))\n                );\n            },\n\n            /** Remove row */\n            _removeRow: function() {\n                if (\n                    [\"init\", \"success\", \"error\"].indexOf(\n                        this.model.get(\"status\")\n                    ) !== -1\n                ) {\n                    this.app.collection.remove(this.model);\n                }\n            },\n\n            /** Attach file info popup */\n            _showSettings: function() {\n                if (!this.settings.visible) {\n                    this.settings.empty();\n                    this.settings.append(new UploadSettings(this).$el);\n                    this.settings.show();\n                } else {\n                    this.settings.hide();\n                }\n            },\n\n            /** View template */\n            _template: function(options) {\n                return (\n                    '<tr id=\"upload-row-' +\n                    options.id +\n                    '\" class=\"upload-row\">' +\n                    \"<td>\" +\n                    '<div class=\"upload-text-column\">' +\n                    '<div class=\"upload-mode\"/>' +\n                    '<div class=\"upload-title\"/>' +\n                    '<div class=\"upload-text\">' +\n                    '<div class=\"upload-text-info\">You can tell Galaxy to download data from web by entering URL in this box (one per line). You can also directly paste the contents of a file.</div>' +\n                    '<textarea class=\"upload-text-content form-control\"/>' +\n                    \"</div>\" +\n                    \"</div>\" +\n                    \"</td>\" +\n                    \"<td>\" +\n                    '<div class=\"upload-size\"/>' +\n                    \"</td>\" +\n                    \"<td>\" +\n                    '<div class=\"upload-extension\" style=\"float: left;\"/>&nbsp;&nbsp' +\n                    '<div class=\"upload-extension-info upload-icon-button fa fa-search\"/>' +\n                    \"</td>\" +\n                    \"<td>\" +\n                    '<div class=\"upload-genome\"/>' +\n                    \"</td>\" +\n                    '<td><div class=\"upload-settings upload-icon-button fa fa-gear\"/></td>' +\n                    \"<td>\" +\n                    '<div class=\"upload-info\">' +\n                    '<div class=\"upload-info-text\"/>' +\n                    '<div class=\"upload-info-progress progress\">' +\n                    '<div class=\"upload-progress-bar progress-bar progress-bar-success\"/>' +\n                    '<div class=\"upload-percentage\">0%</div>' +\n                    \"</div>\" +\n                    \"</div>\" +\n                    \"</td>\" +\n                    \"<td>\" +\n                    '<div class=\"upload-symbol ' +\n                    this.status_classes.init +\n                    '\"/>' +\n                    \"</td>\" +\n                    \"</tr>\"\n                );\n            }\n        });\n    }\n);\n"]}