{"version":3,"sources":["mvc/ui/ui-thumbnails.js"],"names":["define","Utils","Tabs","View","Backbone","extend","events","click .ui-thumbnails-item","dblclick .ui-thumbnails-item","initialize","collection","options","this","tabs","Model","setElement","addClass","render","get","listenTo","$el","model","first","_renderList","index","title_length","$","id","title","tooltip","placement","indexOf","append","self","length","uid","image_src","substr","title_icon","children","add","value","new_value","undefined","before","each","attributes","change_handler","after","_ondblclick","attr","removeClass","_templateThumbnailItem","_onclick","e","target","closest","_templateRegularItem","description"],"mappings":"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","file":"../../../scripts/mvc/ui/ui-thumbnails.js","sourcesContent":["/** This class renders the selection grid. */\ndefine([\"utils/utils\", \"mvc/ui/ui-misc\", \"mvc/ui/ui-tabs\"], function(\n    Utils,\n    Ui,\n    Tabs\n) {\n    var View = Backbone.View.extend({\n        events: {\n            \"click .ui-thumbnails-item\": \"_onclick\",\n            \"dblclick .ui-thumbnails-item\": \"_ondblclick\"\n        },\n\n        initialize: function(options) {\n            this.model = options.model || new Backbone.Model(options);\n            this.collection = new Backbone.Collection(\n                this.model.get(\"collection\")\n            );\n            this.tabs = new Tabs.View({});\n            this.setElement(this.tabs.$el.addClass(\"ui-thumbnails\"));\n            this.render();\n            this.listenTo(this.model, \"change\", this.render, this);\n            this.listenTo(\n                this.collection,\n                \"reset change add remove\",\n                this.render,\n                this\n            );\n        },\n\n        render: function() {\n            this.first = null;\n            this.tabs.delAll();\n            this._renderDefault();\n            this._renderList();\n        },\n\n        _renderDefault: function() {\n            var self = this;\n            var index = [];\n            var title_length = 20;\n            var $el = $(\"<div/>\").addClass(\"ui-thumbnails-grid\");\n            this.collection.each(function(model) {\n                if (model.get(\"keywords\").indexOf(\"default\") !== -1) {\n                    var title = model.get(\"title\");\n                    $el.append(\n                        $(\n                            self._templateThumbnailItem({\n                                id: model.id,\n                                title:\n                                    title.length < title_length\n                                        ? title\n                                        : title.substr(0, title_length) + \"...\",\n                                title_icon: model.get(\"title_icon\"),\n                                image_src: model.get(\"image_src\")\n                            })\n                        ).tooltip({\n                            title: model.get(\"description\"),\n                            placement: \"bottom\"\n                        })\n                    );\n                }\n            });\n            if ($el.children().length > 0) {\n                this.tabs.add({\n                    id: Utils.uid(),\n                    title: self.model.get(\"title_default\"),\n                    $el: $el\n                });\n            }\n        },\n\n        _renderList: function() {\n            var self = this;\n            if (this.collection.length > 0) {\n                this.first = this.first || this.collection.first().id;\n                var $el = $(\"<div/>\").addClass(\"ui-thumbnails-grid\");\n                this.collection.each(function(model) {\n                    $el.append(self._templateRegularItem(model.attributes));\n                });\n                this.tabs.add({\n                    id: Utils.uid(),\n                    title: self.model.get(\"title_list\"),\n                    $el: $el\n                });\n            }\n        },\n\n        /** Set/Get value */\n        value: function(new_value) {\n            if (new_value !== undefined) {\n                new_value = new_value == \"__first\" ? this.first : new_value;\n                var before = this.$(\".ui-thumbnail-current\").attr(\"value\");\n                this.$(\".ui-thumbnail-current\").removeClass(\n                    \"ui-thumbnail-current\"\n                );\n                this.$('[value=\"' + new_value + '\"]').addClass(\n                    \"ui-thumbnail-current\"\n                );\n                var after = this.$(\".ui-thumbnail-current\").attr(\"value\");\n                var change_handler = this.model.get(\"onchange\");\n                after != before && change_handler && change_handler(after);\n            }\n            return this.$(\".ui-thumbnail-current\").attr(\"value\");\n        },\n\n        /** Add click handler */\n        _onclick: function(e) {\n            this.value(\n                $(e.target)\n                    .closest(\".ui-thumbnails-item\")\n                    .attr(\"value\")\n            );\n        },\n\n        /** Add double click handler */\n        _ondblclick: function(e) {\n            this.model.get(\"ondblclick\") &&\n                this.model.get(\"ondblclick\")(this.value());\n        },\n\n        /* Thumbnail template with image */\n        _templateThumbnailItem: function(options) {\n            return (\n                '<div class=\"ui-thumbnails-item ui-thumbnails-item-float\" value=\"' +\n                options.id +\n                '\">' +\n                '<img class=\"ui-thumbnails-image\" src=\"' +\n                options.image_src +\n                '\">' +\n                '<div class=\"ui-thumbnails-title ui-form-info\">' +\n                '<span class=\"fa ' +\n                options.title_icon +\n                '\"/>' +\n                options.title +\n                \"</div>\" +\n                \"<div>\"\n            );\n        },\n\n        /* Thumbnail template with image and description */\n        _templateRegularItem: function(options) {\n            return (\n                '<div class=\"ui-thumbnails-item\" value=\"' +\n                options.id +\n                '\">' +\n                \"<table>\" +\n                \"<tr>\" +\n                \"<td>\" +\n                '<img class=\"ui-thumbnails-image\" src=\"' +\n                options.image_src +\n                '\">' +\n                \"</td>\" +\n                \"<td>\" +\n                '<div class=\"ui-thumbnails-description-title ui-form-info\">' +\n                options.title +\n                \"</div>\" +\n                '<div class=\"ui-thumbnails-description-text ui-form-info\">' +\n                options.description +\n                \"</div>\" +\n                \"</td>\" +\n                \"</tr>\" +\n                \"<div>\"\n            );\n        }\n    });\n\n    return { View: View };\n});\n"]}