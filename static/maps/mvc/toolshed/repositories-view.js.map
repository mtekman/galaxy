{"version":3,"sources":["mvc/toolshed/repositories-view.js"],"names":["define","toolshed_model","Category","Backbone","View","extend","el","initialize","self","params","this","listenTo","CategoryCollection","shed","tool_shed","replace","render","url","model","category_id","fetch","category","category_contents_template","$el","templateCategoryContents","queue","models","bindEvents","toolshed_util","queueLength","css","that","source","require","root","$","term","request","response","tool_shed_url","shed_url","post","result_list","minLength","tsr_id","item","value","data","new_route","history","select","event","ui","options","navigate","trigger","reDraw","empty","_","template","join"],"mappings":"aAAAA,QAAQ,8BAA+B,qBAAsB,SACzDC,EADJD,GAuHI,OACIE,SApHoDC,SAAAC,KAAAC,QACpDC,GAAI,UAGAC,WAAIC,SAAJC,GAEAC,KAAKC,MAAL,IAAcV,EAAdW,mBACAF,KAAIG,SAAOJ,KAAOK,MAAAA,OAAUC,KAAQC,QACpC,IAAAH,EAAWI,EACPH,UAAAC,QAAA,MAAA,OACJL,KAAKQ,MAAMJ,KACX,kBAAsBL,EAAOU,gBAA7BV,EAAAU,YACAT,KAAKQ,MAAME,UAAXP,EAZgDH,KAAAQ,MAAAG,SAAAZ,EAAAU,YAYhDT,KAAKQ,MAAME,SAKXJ,OAAIM,SAAAA,GACJZ,KAAKa,QACDD,EAAAA,OAAAA,KAAAA,QAAAA,GACID,IAAAA,EAAUX,KADac,yBAEvBV,KAAAA,IAAAA,KACAW,GAJRJ,SAAAX,KAAAQ,MAAAQ,OAAA,GAOEZ,UAAeJ,KAAAQ,MAAYJ,UACxBa,MAALC,EAAAC,iBAGJF,EAAAA,WAAYG,IAAA,WAAA,QACRpB,KAAIqB,cAGIC,WAAAA,WACI,IAAAD,EAAArB,KAIAuB,SAAA,yBAAsBC,WACtBC,EAAA,eAAI1B,cACA2B,OAAAA,SAAMC,EADGC,GAETC,IAAAA,EAAAA,EAAeC,MAAAA,UAAAA,QAFnB,OAIEC,KAEEH,EAASI,OAAAA,KAAT,uBAFJjC,GAXsB2B,KAAAC,EAAAD,KAgB1BO,cAhB0BH,GAkBtBL,EAAAM,KAAIG,EAAYC,EAAKC,SAArBC,GACIC,IAAAA,EACApB,EACAG,WAAWjB,GAGfX,EAAS8C,MAA4BN,UAArC,EAIHO,OAAA,SAAAC,EAAAC,GA5BL,IAAAR,EAAAQ,EAAAP,KAAAC,MADJE,EA/BgD,gBAqDhCjB,EAAKb,MAAMJ,UAYvB,MACJ8B,EACKrC,SAAW8C,QAAhBC,SAAAN,GAnEgDO,SAAA,EA0DhCxC,SAAS,UA9DrCyC,OAAA,SAAAH,GAsEY3C,KAAKa,IAAIkC,QACT/C,KAAKH,WAAW8C,IAGpB7B,yBAA0BkC,EAAEC,UAEpB,0BACA,+CACA,6CACA,WACA,yEACA,4FACA,wJACA,SACA,0DACA,+DACA,4BACA,8LACA,UACA,SACA,8CACA,uBACA,iCACA,OACA,qCACA,oCACA,oBACA,oCACA,QACA,WACA,oEACA,OACA,mCACA,OACA,wEACA,8FACA,SACA,QACA,yCACA,kCACA,QACA,YACA,WACA,SACA,UACFC,KAAK","file":"../../../scripts/mvc/toolshed/repositories-view.js","sourcesContent":["define([\"mvc/toolshed/toolshed-model\", \"mvc/toolshed/util\"], function(\n    toolshed_model,\n    toolshed_util\n) {\n    var ToolShedCategoryContentsView = Backbone.View.extend({\n        el: \"#center\",\n\n        initialize: function(params) {\n            var self = this;\n            this.model = new toolshed_model.CategoryCollection();\n            this.listenTo(this.model, \"sync\", this.render);\n            var shed = params.tool_shed.replace(/\\//g, \"%2f\");\n            this.model.url +=\n                \"?tool_shed_url=\" + shed + \"&category_id=\" + params.category_id;\n            this.model.tool_shed = shed;\n            this.model.category = params.category_id;\n            this.model.fetch();\n        },\n\n        render: function(options) {\n            this.options = _.extend(this.options, options);\n            var category_contents_template = this.templateCategoryContents;\n            this.$el.html(\n                category_contents_template({\n                    category: this.model.models[0],\n                    tool_shed: this.model.tool_shed,\n                    queue: toolshed_util.queueLength()\n                })\n            );\n            $(\"#center\").css(\"overflow\", \"auto\");\n            this.bindEvents();\n        },\n\n        bindEvents: function() {\n            var that = this;\n            require([\"libs/jquery/jquery-ui\"], function() {\n                $(\"#search_box\").autocomplete({\n                    source: function(request, response) {\n                        var shed_url = that.model.tool_shed.replace(\n                            /%2f/g,\n                            \"/\"\n                        );\n                        var base_url = Galaxy.root + \"api/tool_shed/search\";\n                        var params = {\n                            term: request.term,\n                            tool_shed_url: shed_url\n                        };\n                        $.post(base_url, params, function(data) {\n                            var result_list = toolshed_util.shedParser(data);\n                            response(result_list);\n                        });\n                    },\n                    minLength: 3,\n                    select: function(event, ui) {\n                        var tsr_id = ui.item.value;\n                        var new_route =\n                            \"repository/s/\" +\n                            that.model.tool_shed +\n                            \"/r/\" +\n                            tsr_id;\n                        Backbone.history.navigate(new_route, {\n                            trigger: true,\n                            replace: true\n                        });\n                    }\n                });\n            });\n        },\n\n        reDraw: function(options) {\n            this.$el.empty();\n            this.initialize(options);\n        },\n\n        templateCategoryContents: _.template(\n            [\n                '<style type=\"text/css\">',\n                \".ui-autocomplete { background-color: #fff; }\",\n                \"li.ui-menu-item { list-style-type: none; }\",\n                \"</style>\",\n                '<div class=\"unified-panel-header\" id=\"panel_header\" unselectable=\"on\">',\n                '<div class=\"unified-panel-header-inner\">Repositories in <%= category.get(\"name\") %></div>',\n                '<div class=\"unified-panel-header-inner\" style=\"position: absolute; right: 5px; top: 0px;\"><a href=\"#/queue\">Repository Queue (<%= queue %>)</a></div>',\n                \"</div>\",\n                '<div class=\"unified-panel-body\" id=\"list_repositories\">',\n                '<div id=\"standard-search\" style=\"height: 2em; margin: 1em;\">',\n                '<span class=\"ui-widget\" >',\n                '<input class=\"search-box-input\" id=\"search_box\" name=\"search\" data-shedurl=\"<%= tool_shed.replace(/%2f/g, \"/\") %>\" placeholder=\"Search repositories by name or id\" size=\"60\" type=\"text\" />',\n                \"</span>\",\n                \"</div>\",\n                '<div style=\"clear: both; margin-top: 1em;\">',\n                '<table class=\"grid\">',\n                '<thead id=\"grid-table-header\">',\n                \"<tr>\",\n                '<th style=\"width: 10%;\">Owner</th>',\n                '<th style=\"width: 15%;\">Name</th>',\n                \"<th>Synopsis</th>\",\n                '<th style=\"width: 10%;\">Type</th>',\n                \"</tr>\",\n                \"</thead>\",\n                '<% _.each(category.get(\"repositories\"), function(repository) { %>',\n                \"<tr>\",\n                \"<td><%= repository.owner %></td>\",\n                \"<td>\",\n                '<div style=\"float: left; margin-left: 1px;\" class=\"menubutton split\">',\n                '<a href=\"#/repository/s/<%= tool_shed %>/r/<%= repository.id %>\"><%= repository.name %></a>',\n                \"</div>\",\n                \"</td>\",\n                \"<td><%= repository.description %></td>\",\n                \"<td><%= repository.type %></td>\",\n                \"</tr>\",\n                \"<% }); %>\",\n                \"</table>\",\n                \"</div>\",\n                \"</div>\"\n            ].join(\"\")\n        )\n    });\n\n    return {\n        Category: ToolShedCategoryContentsView\n    };\n});\n"]}