{"version":3,"sources":["mvc/toolshed/workflows-view.js"],"names":["define","toolshed_model","Workflows","Backbone","View","extend","el","defaults","initialize","that","options","this","listenTo","WorkflowTools","model","fetch","render","workflows_missing_tools","workflows","models","templateWorkflows","title","queue","toolshed_util","css","queueLength","$","bindEvents","repository_id","tool_ids","Galaxy","params","get","attr","data","repository","new_route","history","navigate","trigger","id","replace","toolshed","elem","tool_shed_url","api_url","root","changesets","keys","current_changeset","current_metadata","addToQueue","Object","metadata","empty","remove","template","loadWorkflows","reDraw","_","join"],"mappings":"aAAAA,QAAQ,8BAA+B,qBAAsB,SACzDC,EADJD,GA0II,OACIE,UAtIIC,SADwBC,KAAAC,QAC5BC,GAAI,UAEJC,cAGIC,WAAIC,SAAJC,GACA,IAAAD,EAAAE,KACAA,KAAKC,MAAL,IAAcX,EAAdY,cACAF,KAAKG,SAAMC,KAAXD,MAAA,OAAAH,KAAAK,QACAP,KAAKO,MAALD,QAVwBN,EAAAO,UAcxBA,OAAIP,SAAOC,GACX,IAAIO,EAAAA,KACAC,EAAuBC,EAA3BC,kBACAX,EACIQ,EAAAA,MAAAA,OACII,EAAAA,IAAAA,KACAH,GACAI,MAAOC,0BAJfL,UAAAA,EAOEI,MAAWE,EAAgBC,iBAA7BC,EAAE,WAAWF,IAAI,WAAY,QAIjCG,EAAAA,cAGID,WAAE,WACE,IACAE,EADAnB,EAAIoB,KAEJH,EAAA,iBAAcI,GAAAA,QAAA,WACd,IAAIC,EAAWF,EAAAA,MAAAA,KAAUA,gBACvBG,EAAaD,EAAAA,MAAQE,KAAA,aACnBL,EAAAA,OAAgBM,KAAKC,2BACrBJ,GAAIK,SACAP,GAIJ1B,EAAAA,IAAAA,EAASkC,EAAQC,SAASF,GACtBG,EAASL,EADwBC,WAAAK,GAEjCC,IAAAA,EAFJ,gBAPJC,EAAAD,QAAA,KAAA,OAAAA,QAAA,MAAA,OALJ,MAkBEP,EAAAC,WAAqBK,GACfG,SAASN,QAAbC,SAAAF,GACIP,SAAWc,EACXD,SAAWC,QAIXf,EAAAA,kBAAAA,GAAAA,QAAqBO,WACrBJ,IAAAA,EAAAA,EAASpB,MACLiC,EAAAA,EAAAA,KAAeF,gBACfd,EAAAA,EAAAA,KAAeA,aAFViB,EAATf,OAAAgB,KAAA,2BAIApB,GAAMmB,SAANhB,GACIH,EAAAM,IAAAa,EAAIE,EAAAA,SAAoBC,GACxBpB,EAAIqB,EAAAA,WAAoBF,GACxBhB,GAEAmB,cAAAA,EACA3B,cAAc4B,GAEjBzB,EARDM,IAAAa,EAAAd,EAAA,SAAAG,GANJ,IANJe,EAMIG,OAAAJ,KAAAd,EAAAC,WAAAkB,UANJ,GAuBEH,EAxEsBhB,EAAAC,WAAAkB,SAAAJ,GAkEZC,EAAiBN,cAAgBF,EASzCnB,EAASb,WAASwC,GACbI,EAATC,eAIJnC,EAAAA,kBAAqBoC,GAAAA,QAEb/C,EAAAgD,gBAoDZC,OAAO,SAAAhD,GACHR,KAAAA,IAAWE,QADfO,KAAAH,WAAAE,IAtDIU,kBAAmBuC,EAAEH,UAEb,yEACA,6DACA,wJACA,SACA,0BACA,2HACA,WACA,4GACA,iCACA,OACA,wCACA,uCACA,mCACA,mCACA,oCACA,sCACA,QACA,WACA,UACA,+CACA,OACA,0BACA,8BACA,2DACA,8CACA,YACA,QACA,QACA,0BACA,8BACA,uDACA,8CACA,YACA,QACA,QACA,0DACA,gEACA,2DACA,0BACA,8BACA,8BACA,kRACA,QACA,QACA,QACA,YACA,QACA,UACFI,KAAK","file":"../../../scripts/mvc/toolshed/workflows-view.js","sourcesContent":["define([\"mvc/toolshed/toolshed-model\", \"mvc/toolshed/util\"], function(\n    toolshed_model,\n    toolshed_util\n) {\n    var View = Backbone.View.extend({\n        el: \"#center\",\n\n        defaults: [{}],\n\n        initialize: function(options) {\n            var that = this;\n            this.model = new toolshed_model.WorkflowTools();\n            this.listenTo(this.model, \"sync\", this.render);\n            this.model.fetch();\n            that.render();\n        },\n\n        render: function(options) {\n            var that = this;\n            var workflows_missing_tools = that.templateWorkflows;\n            var workflows = that.model.models;\n            that.$el.html(\n                workflows_missing_tools({\n                    title: \"Workflows Missing Tools\",\n                    workflows: workflows,\n                    queue: toolshed_util.queueLength()\n                })\n            );\n            $(\"#center\").css(\"overflow\", \"auto\");\n            that.bindEvents();\n        },\n\n        bindEvents: function() {\n            var that = this,\n                repository_id;\n            $(\".show_wf_repo\").on(\"click\", function() {\n                var tool_ids = $(this).attr(\"data-toolids\");\n                var toolshed = $(this).attr(\"data-shed\");\n                var api_url = Galaxy.root + \"api/tool_shed/repository\";\n                var params = { tool_ids: tool_ids };\n                $.get(api_url, params, function(data) {\n                    repository_id = data.repository.id;\n                    var new_route =\n                        \"repository/s/\" +\n                        toolshed.replace(/:/g, \"%3a\").replace(/\\//g, \"%2f\") +\n                        \"/r/\" +\n                        data.repository.id;\n                    Backbone.history.navigate(new_route, {\n                        trigger: true,\n                        replace: true\n                    });\n                });\n            });\n            $(\".queue_wf_repo\").on(\"click\", function() {\n                var elem = $(this);\n                var tool_ids = elem.attr(\"data-toolids\");\n                var toolshed = elem.attr(\"data-shed\");\n                var api_url = Galaxy.root + \"api/tool_shed/repository\";\n                var params = { tool_ids: tool_ids };\n                $.get(api_url, params, function(data) {\n                    repository_id = data.repository.id;\n                    params = {\n                        tool_shed_url: toolshed,\n                        repository_id: repository_id\n                    };\n                    $.get(api_url, params, function(data) {\n                        var changesets = Object.keys(data.repository.metadata);\n                        var current_changeset = changesets[0];\n                        var current_metadata =\n                            data.repository.metadata[current_changeset];\n                        current_metadata.tool_shed_url = toolshed;\n                        toolshed_util.addToQueue(current_metadata);\n                        elem.remove();\n                    });\n                });\n            });\n            $(\"#from_workflow\").on(\"click\", that.loadWorkflows);\n        },\n\n        reDraw: function(options) {\n            this.$el.empty();\n            this.initialize(options);\n        },\n\n        templateWorkflows: _.template(\n            [\n                '<div class=\"unified-panel-header\" id=\"panel_header\" unselectable=\"on\">',\n                '<div class=\"unified-panel-header-inner\"><%= title %></div>',\n                '<div class=\"unified-panel-header-inner\" style=\"position: absolute; right: 5px; top: 0px;\"><a href=\"#/queue\">Repository Queue (<%= queue %>)</a></div>',\n                \"</div>\",\n                '<style type=\"text/css\">',\n                \".workflow_names, .workflow_tools { list-style-type: none; } ul.workflow_tools, ul.workflow_names {  padding-left: 0px; }\",\n                \"</style>\",\n                '<table id=\"workflows_missing_tools\" class=\"grid\" border=\"0\" cellpadding=\"2\" cellspacing=\"2\" width=\"100%\">',\n                '<thead id=\"grid-table-header\">',\n                \"<tr>\",\n                '<th class=\"datasetRow\">Workflows</th>',\n                '<th class=\"datasetRow\">Tool IDs</th>',\n                '<th class=\"datasetRow\">Shed</th>',\n                '<th class=\"datasetRow\">Name</th>',\n                '<th class=\"datasetRow\">Owner</th>',\n                '<th class=\"datasetRow\">Actions</th>',\n                \"</tr>\",\n                \"</thead>\",\n                \"<tbody>\",\n                \"<% _.each(workflows, function(workflow) { %>\",\n                \"<tr>\",\n                '<td class=\"datasetRow\">',\n                '<ul class=\"workflow_names\">',\n                '<% _.each(workflow.get(\"workflows\"), function(name) { %>',\n                '<li class=\"workflow_names\"><%= name %></li>',\n                \"<% }); %>\",\n                \"</ul>\",\n                \"</td>\",\n                '<td class=\"datasetRow\">',\n                '<ul class=\"workflow_tools\">',\n                '<% _.each(workflow.get(\"tools\"), function(tool) { %>',\n                '<li class=\"workflow_tools\"><%= tool %></li>',\n                \"<% }); %>\",\n                \"</ul>\",\n                \"</td>\",\n                '<td class=\"datasetRow\"><%= workflow.get(\"shed\") %></td>',\n                '<td class=\"datasetRow\"><%= workflow.get(\"repository\") %></td>',\n                '<td class=\"datasetRow\"><%= workflow.get(\"owner\") %></td>',\n                '<td class=\"datasetRow\">',\n                '<ul class=\"workflow_tools\">',\n                '<li class=\"workflow_tools\">',\n                '<input type=\"button\" class=\"show_wf_repo btn btn-primary\" data-shed=\"<%= workflow.get(\"shed\") %>\" data-owner=\"<%= workflow.get(\"owner\") %>\" data-repo=\"<%= workflow.get(\"repository\") %>\" data-toolids=\"<%= workflow.get(\"tools\").join(\",\") %>\" value=\"Show Repository\" /></li>',\n                \"</ul>\",\n                \"</td>\",\n                \"</tr>\",\n                \"<% }); %>\",\n                \"</ul>\",\n                \"</div>\"\n            ].join(\"\")\n        )\n    });\n\n    return {\n        Workflows: View\n    };\n});\n"]}