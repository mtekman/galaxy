{"version":3,"sources":["mvc/user/user-preferences.js"],"names":["define","Form","Ui","QueryStringParsing","Model","Backbone","extend","initialize","options","user_id","Galaxy","user","id","this","set","information","title","description","icon","redirect","url","submit_title","communication","permissions","api_key","submit_icon","toolbox_filters","openids","onclick","window","location","custom_builds","show","body","buttons","href","Cancel","root","logout","View","modal","hide","$","addClass","prepend","self","_addLink","model","config","enable_openid","$preferences","append","empty","data","action","find","_","escape","email","$table","$row","_templateLink","message","get","status","Message","$el","use_remote_user","enable_communication_server","has_user_tool_filters","session_csrf_token","_templateFooter","$a","on","attr","nice_total_disk_usage","enable_quotas","quota"],"mappings":"aACAA,QADA,qBAAA,iBAAA,8BACAA,SACKC,EAAAC,EAAAC,GAGOC,IAAAA,EAAQC,SAASD,MAAME,QACvBC,WAAY,SAAAC,IACRA,EAAUA,OACFC,QAAUD,EAAQC,SAAWC,OAAAC,KAArCC,GACAC,KAASC,KACLL,QAASD,EAAQC,QACjBM,aACIC,MAAO,qBACPC,YAGI,4EAGJC,IACAC,aAXCX,EAAAC,QAaK,sBACNO,KAAO,UACPC,SACI,QAEJG,UAEAC,MAAAA,kBACAF,YArBC,+CAuBLG,KAAAA,gBACIN,IACAC,aACIT,EAAAC,QAAA,mBACJW,aACI,gBAGJF,SAAM,QA/BLI,eAkCLC,MAAa,gCACTP,YACAC,wEAEAG,IAIM,aACNC,EAAcZ,QACdU,wBA5CCD,KAAA,gBA8CLM,SAAS,QAELP,aAEAG,MAAK,4CACLF,YACAG,sJACAI,IArDC,aAuDLC,EAAiBjB,QACN,sBACPQ,KAAAA,WAEAG,aACI,mBAGJF,SAAM,QAENC,SAjECH,MAAA,iBAmELW,YACW,mDACPV,IAAAA,aAAaT,EAAAC,QAAA,kBACbS,KAAM,SACNU,aAAS,mBACLC,YAAOC,YAxEVJ,iBA6ELK,MAAe,yBACXf,YACAC,kEAEAC,IACAU,aACIC,EAAOC,QAEV,0BArFAZ,KAAA,YAuFGG,aAAA,eACJL,SAAO,QAEPE,SACAU,MAAS,iBACLlB,YAAasB,uCACThB,KAAAA,YACAiB,QAAAA,WAEAC,OAAAA,SAASC,KACLC,OAAAA,KACI1B,qDAGAmB,eAIHb,MAAA,uBATIC,YAJb,sDAgBHC,KAAA,WArBGU,QAAA,WAvFZC,OAAAC,SAAAK,KA+GHzB,OAAA2B,KAAA,kBAGLC,QACoBC,MAAKjC,WACdW,YADqB,0CAEhBC,KAAA,cACRU,QAAiBxB,WACDM,OAAA8B,MAAhBR,MACAhB,MAAA,WALwBiB,KApBJ,+DA4BhBC,SACJE,OAAA,WACA1B,OAAA8B,MAAAC,QAIwBC,WACfC,WAcSxC,OAAAA,SAAuBgC,KACxBhC,OAAAkC,KACU,kCACDO,OACV1C,8BA+ExB,OACIqC,KAnEQM,SAAKC,KAASxC,QACdU,MAAA,mBACI6B,WAAAA,WACHhC,KAAAkC,MAAA,IAAA3C,EACDS,KAAImC,WAAOC,UACPJ,KAAAA,UAGAA,OAAAA,WACH,IAAAA,EAAAhC,KACDgC,EAAKK,OAAaC,OAClBN,EAAAA,QAASO,OAAQD,KAAON,aAAKK,OAA7BvC,KAAAC,GAAA,SA9CJyC,GAGIR,EAAKK,aAAeR,EAAE,UA+CpBC,SAAA,YACFnC,OAAeuC,EAAAA,SAAUO,OAA7B,qBACaH,OACCI,EAAL,QAATJ,OACA,gCACmBK,EAAAC,OAAWJ,EAAAK,OACtB,eAGIP,OACXN,EAAAc,OAAAjB,EAAA,YAAAC,SACkBiB,mBAGvBC,IAAeC,EAAA3D,EAAA4D,IAAkB,WAEzBC,EACA7D,EACA4D,IAAA,UA/EoBD,GAAAE,GAgChBnB,EAAKK,aAAaN,QA+Db,IAAA1C,EAAA+D,SAAAH,QAAStD,EAASwD,OAAAA,IAE3BE,KA5DKlB,EAAOmB,kBA2EjBtB,EAAAC,SAAA,eAAAD,EAAAC,SAAA,aAAPE,EAAAoB,6BA3ORvB,EAAAC,SAAA,iBAuKoBD,EAAKC,SAAS,iBACdD,EAAKC,SAAS,eACdD,EAAKC,SAAS,WACVE,EAAOqB,uBACPxB,EAAKC,SAAS,mBAEdE,EAAOC,gBAAkBD,EAAOmB,iBAChCtB,EAAKC,SAAS,WAEdpC,OAAO4D,oBACPzB,EAAKC,SAAS,UAElBD,EAAKK,aAAaC,OAAON,EAAK0B,gBAAgBlB,IAC9CR,EAAKqB,IAAId,QAAQD,OAAON,EAAKK,iBAIrCJ,SAAU,SAASQ,GACf,IAAI9C,EAAUK,KAAKkC,MAAMgB,IAAIT,GACzBM,EAAOlB,EAAE7B,KAAKgD,cAAcrD,IAC5BgE,EAAKZ,EAAKL,KAAK,KACf/C,EAAQoB,QACR4C,EAAGC,GAAG,QAAS,WACXjE,EAAQoB,YAGZ4C,EAAGE,KAAK,OAAQhE,OAAO2B,KAAO,QAAUiB,GAE5CzC,KAAK8C,OAAOR,OAAOS,IAGvBC,cAAe,SAASrD,GACpB,MACI,wCAGAA,EAAQU,KACR,mEAIAV,EAAQQ,MACR,iCAEAR,EAAQS,YACR,oBAMRsD,gBAAiB,SAAS/D,GACtB,MACI,oDAEAA,EAAQmE,sBACR,qDACCjE,OAAOsC,OAAO4B,cACT,+BACApE,EAAQqE,MACR,cACA,IACN,2MAQRzE,MAAOA","file":"../../../scripts/mvc/user/user-preferences.js","sourcesContent":["/** User Preferences view */\ndefine(\n    [\"mvc/form/form-view\", \"mvc/ui/ui-misc\", \"utils/query-string-parsing\"],\n    function(Form, Ui, QueryStringParsing) {\n        /** Contains descriptive dictionaries describing user forms */\n        var Model = Backbone.Model.extend({\n            initialize: function(options) {\n                options = options || {};\n                options.user_id = options.user_id || Galaxy.user.id;\n                this.set({\n                    user_id: options.user_id,\n                    information: {\n                        title: \"Manage information\",\n                        description:\n                            \"Edit your email, addresses and custom parameters or change your username.\",\n                        url:\n                            \"api/users/\" +\n                            options.user_id +\n                            \"/information/inputs\",\n                        icon: \"fa-user\",\n                        redirect: \"user\"\n                    },\n                    password: {\n                        title: \"Change password\",\n                        description:\n                            \"Allows you to change your login credentials.\",\n                        icon: \"fa-unlock-alt\",\n                        url:\n                            \"api/users/\" + options.user_id + \"/password/inputs\",\n                        submit_title: \"Save password\",\n                        redirect: \"user\"\n                    },\n                    communication: {\n                        title: \"Change communication settings\",\n                        description:\n                            \"Enable or disable the communication feature to chat with other users.\",\n                        url:\n                            \"api/users/\" +\n                            options.user_id +\n                            \"/communication/inputs\",\n                        icon: \"fa-comments-o\",\n                        redirect: \"user\"\n                    },\n                    permissions: {\n                        title: \"Set dataset permissions for new histories\",\n                        description:\n                            \"Grant others default access to newly created histories. Changes made here will only affect histories created after these settings have been stored.\",\n                        url:\n                            \"api/users/\" +\n                            options.user_id +\n                            \"/permissions/inputs\",\n                        icon: \"fa-users\",\n                        submit_title: \"Save permissions\",\n                        redirect: \"user\"\n                    },\n                    api_key: {\n                        title: \"Manage API key\",\n                        description:\n                            \"Access your current API key or create a new one.\",\n                        url: \"api/users/\" + options.user_id + \"/api_key/inputs\",\n                        icon: \"fa-key\",\n                        submit_title: \"Create a new key\",\n                        submit_icon: \"fa-check\"\n                    },\n                    toolbox_filters: {\n                        title: \"Manage Toolbox filters\",\n                        description:\n                            \"Customize your Toolbox by displaying or omitting sets of Tools.\",\n                        url:\n                            \"api/users/\" +\n                            options.user_id +\n                            \"/toolbox_filters/inputs\",\n                        icon: \"fa-filter\",\n                        submit_title: \"Save filters\",\n                        redirect: \"user\"\n                    },\n                    openids: {\n                        title: \"Manage OpenIDs\",\n                        description: \"Associate OpenIDs with your account.\",\n                        icon: \"fa-openid\",\n                        onclick: function() {\n                            window.location.href =\n                                Galaxy.root +\n                                \"user/openid_manage?cntrller=user&use_panels=True\";\n                        }\n                    },\n                    custom_builds: {\n                        title: \"Manage custom builds\",\n                        description:\n                            \"Add or remove custom builds using history datasets.\",\n                        icon: \"fa-cubes\",\n                        onclick: function() {\n                            window.location.href =\n                                Galaxy.root + \"custom_builds\";\n                        }\n                    },\n                    logout: {\n                        title: \"Sign out\",\n                        description: \"Click here to sign out of all sessions.\",\n                        icon: \"fa-sign-out\",\n                        onclick: function() {\n                            Galaxy.modal.show({\n                                title: \"Sign out\",\n                                body:\n                                    \"Do you want to continue and sign out of all active sessions?\",\n                                buttons: {\n                                    Cancel: function() {\n                                        Galaxy.modal.hide();\n                                    },\n                                    \"Sign out\": function() {\n                                        window.location.href =\n                                            Galaxy.root +\n                                            \"user/logout?session_csrf_token=\" +\n                                            Galaxy.session_csrf_token;\n                                    }\n                                }\n                            });\n                        }\n                    }\n                });\n            }\n        });\n\n        /** View of the main user preference panel with links to individual user forms */\n        var View = Backbone.View.extend({\n            title: \"User Preferences\",\n            initialize: function() {\n                this.model = new Model();\n                this.setElement(\"<div/>\");\n                this.render();\n            },\n\n            render: function() {\n                var self = this;\n                var config = Galaxy.config;\n                $.getJSON(Galaxy.root + \"api/users/\" + Galaxy.user.id, function(\n                    data\n                ) {\n                    self.$preferences = $(\"<div/>\")\n                        .addClass(\"ui-panel\")\n                        .append($(\"<h2/>\").append(\"User preferences\"))\n                        .append(\n                            $(\"<p/>\").append(\n                                \"You are logged in as <strong>\" +\n                                    _.escape(data.email) +\n                                    \"</strong>.\"\n                            )\n                        )\n                        .append(\n                            (self.$table = $(\"<table/>\").addClass(\n                                \"ui-panel-table\"\n                            ))\n                        );\n                    var message = QueryStringParsing.get(\"message\");\n                    var status = QueryStringParsing.get(\"status\");\n                    if (message && status) {\n                        self.$preferences.prepend(\n                            new Ui.Message({ message: message, status: status })\n                                .$el\n                        );\n                    }\n                    if (!config.use_remote_user) {\n                        self._addLink(\"information\");\n                        self._addLink(\"password\");\n                    }\n                    if (config.enable_communication_server) {\n                        self._addLink(\"communication\");\n                    }\n                    self._addLink(\"custom_builds\");\n                    self._addLink(\"permissions\");\n                    self._addLink(\"api_key\");\n                    if (config.has_user_tool_filters) {\n                        self._addLink(\"toolbox_filters\");\n                    }\n                    if (config.enable_openid && !config.use_remote_user) {\n                        self._addLink(\"openids\");\n                    }\n                    if (Galaxy.session_csrf_token) {\n                        self._addLink(\"logout\");\n                    }\n                    self.$preferences.append(self._templateFooter(data));\n                    self.$el.empty().append(self.$preferences);\n                });\n            },\n\n            _addLink: function(action) {\n                var options = this.model.get(action);\n                var $row = $(this._templateLink(options));\n                var $a = $row.find(\"a\");\n                if (options.onclick) {\n                    $a.on(\"click\", function() {\n                        options.onclick();\n                    });\n                } else {\n                    $a.attr(\"href\", Galaxy.root + \"user/\" + action);\n                }\n                this.$table.append($row);\n            },\n\n            _templateLink: function(options) {\n                return (\n                    \"<tr>\" +\n                    \"<td>\" +\n                    '<div class=\"ui-panel-icon fa ' +\n                    options.icon +\n                    '\">' +\n                    \"</td>\" +\n                    \"<td>\" +\n                    '<a class=\"ui-panel-anchor\" href=\"javascript:void(0)\">' +\n                    options.title +\n                    \"</a>\" +\n                    '<div class=\"ui-form-info\">' +\n                    options.description +\n                    \"</div>\" +\n                    \"</td>\" +\n                    \"</tr>\"\n                );\n            },\n\n            _templateFooter: function(options) {\n                return (\n                    '<p class=\"ui-panel-footer\">' +\n                    \"You are using <strong>\" +\n                    options.nice_total_disk_usage +\n                    \"</strong> of disk space in this Galaxy instance. \" +\n                    (Galaxy.config.enable_quotas\n                        ? \"Your disk quota is: <strong>\" +\n                          options.quota +\n                          \"</strong>. \"\n                        : \"\") +\n                    'Is your usage more than expected? See the <a href=\"https://galaxyproject.org/learn/managing-datasets/\" target=\"_blank\">documentation</a> for tips on how to find all of the data in your account.' +\n                    \"</p>\"\n                );\n            }\n        });\n\n        return {\n            View: View,\n            Model: Model\n        };\n    }\n);\n"]}