{"version":3,"sources":["mvc/dataset/dataset-edit-attributes.js"],"names":["define","Utils","Tabs","Ui","Form","View","Backbone","extend","initialize","this","setElement","model","Model","dataset_id","Galaxy","params","message","Message","persistent","tabs","_createTabs","append","render","$","$el","hide","self","initial_message","_","form","get","show","response","update","err_msg","responseJSON","key","set","status","error","operation","data","create","_submit","ajax","type","url","root","success","attribute","_reloadHistory","datatype","_getDatatype","permission","tooltip","forms","_getAttribute","conversion","_getConversion","title","_getPermission","icon","add","id","operations","submit_attributes","onclick","submit_autodetect","ButtonIcon","submit_conversion","submit_datatype","submit_permission","window","currHistoryPanel","loadCurrentHistory"],"mappings":"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","file":"../../../scripts/mvc/dataset/dataset-edit-attributes.js","sourcesContent":["/** Dataset edit attributes view */\ndefine(\n    [\"utils/utils\", \"mvc/ui/ui-tabs\", \"mvc/ui/ui-misc\", \"mvc/form/form-view\"],\n    function(Utils, Tabs, Ui, Form) {\n        var View = Backbone.View.extend({\n            initialize: function() {\n                this.setElement(\"<div/>\");\n                this.model = new Backbone.Model({\n                    dataset_id: Galaxy.params.dataset_id\n                });\n                this.message = new Ui.Message({ persistent: true });\n                this.tabs = this._createTabs();\n                this.$el\n                    .append($(\"<h4/>\").append(\"Edit dataset attributes\"))\n                    .append(this.message.$el)\n                    .append(\"<p/>\")\n                    .append(this.tabs.$el)\n                    .hide();\n                this.render();\n            },\n\n            /** fetch data for the selected dataset and build forms */\n            render: function() {\n                var self = this;\n                $.ajax({\n                    url:\n                        Galaxy.root +\n                        \"dataset/get_edit?dataset_id=\" +\n                        self.model.get(\"dataset_id\"),\n                    success: function(response) {\n                        !self.initial_message && self.message.update(response);\n                        self.initial_message = true;\n                        _.each(self.forms, function(form, key) {\n                            form.model.set(\"inputs\", response[key + \"_inputs\"]);\n                            form.model.set(\n                                \"hide_operations\",\n                                response[key + \"_disable\"]\n                            );\n                            form.render();\n                        });\n                        self.$el.show();\n                    },\n                    error: function(response) {\n                        var err_msg =\n                            response.responseJSON &&\n                            response.responseJSON.err_msg;\n                        self.message.update({\n                            status: \"danger\",\n                            message:\n                                err_msg ||\n                                \"Error occured while loading the dataset.\"\n                        });\n                    }\n                });\n            },\n\n            /** submit data to backend to update attributes */\n            _submit: function(operation, form) {\n                var self = this;\n                var data = form.data.create();\n                data.dataset_id = this.model.get(\"dataset_id\");\n                data.operation = operation;\n                $.ajax({\n                    type: \"PUT\",\n                    url: Galaxy.root + \"dataset/set_edit\",\n                    data: data,\n                    success: function(response) {\n                        self.message.update(response);\n                        self.render();\n                        self._reloadHistory();\n                    },\n                    error: function(response) {\n                        var err_msg =\n                            response.responseJSON &&\n                            response.responseJSON.err_msg;\n                        self.message.update({\n                            status: \"danger\",\n                            message:\n                                err_msg ||\n                                \"Error occured while editing the dataset attributes.\"\n                        });\n                    }\n                });\n            },\n\n            /** create tabs for different dataset attribute categories*/\n            _createTabs: function() {\n                this.forms = {\n                    attribute: this._getAttribute(),\n                    conversion: this._getConversion(),\n                    datatype: this._getDatatype(),\n                    permission: this._getPermission()\n                };\n                var tabs = new Tabs.View();\n                tabs.add({\n                    id: \"attribute\",\n                    title: \"Attributes\",\n                    icon: \"fa fa-bars\",\n                    tooltip: \"Edit dataset attributes\",\n                    $el: this.forms.attribute.$el\n                });\n                tabs.add({\n                    id: \"convert\",\n                    title: \"Convert\",\n                    icon: \"fa-gear\",\n                    tooltip: \"Convert to new format\",\n                    $el: this.forms.conversion.$el\n                });\n                tabs.add({\n                    id: \"datatype\",\n                    title: \"Datatypes\",\n                    icon: \"fa-database\",\n                    tooltip: \"Change data type\",\n                    $el: this.forms.datatype.$el\n                });\n                tabs.add({\n                    id: \"permissions\",\n                    title: \"Permissions\",\n                    icon: \"fa-user\",\n                    tooltip: \"Permissions\",\n                    $el: this.forms.permission.$el\n                });\n                return tabs;\n            },\n\n            /** edit main attributes form */\n            _getAttribute: function() {\n                var self = this;\n                var form = new Form({\n                    title: \"Edit attributes\",\n                    operations: {\n                        submit_attributes: new Ui.ButtonIcon({\n                            tooltip: \"Save attributes of the dataset.\",\n                            icon: \"fa-floppy-o\",\n                            title: \"Save\",\n                            onclick: function() {\n                                self._submit(\"attributes\", form);\n                            }\n                        }),\n                        submit_autodetect: new Ui.ButtonIcon({\n                            tooltip:\n                                \"This will inspect the dataset and attempt to correct the values of fields if they are not accurate.\",\n                            icon: \"fa-undo\",\n                            title: \"Auto-detect\",\n                            onclick: function() {\n                                self._submit(\"autodetect\", form);\n                            }\n                        })\n                    }\n                });\n                return form;\n            },\n\n            /** datatype conversion form */\n            _getConversion: function() {\n                var self = this;\n                var form = new Form({\n                    title: \"Convert to new format\",\n                    operations: {\n                        submit_conversion: new Ui.ButtonIcon({\n                            tooltip: \"Convert the datatype to a new format.\",\n                            title: \"Convert datatype\",\n                            icon: \"fa-exchange\",\n                            onclick: function() {\n                                self._submit(\"conversion\", form);\n                            }\n                        })\n                    }\n                });\n                return form;\n            },\n\n            /** change datatype form */\n            _getDatatype: function() {\n                var self = this;\n                var form = new Form({\n                    title: \"Change datatype\",\n                    operations: {\n                        submit_datatype: new Ui.ButtonIcon({\n                            tooltip: \"Change the datatype to a new type.\",\n                            title: \"Change datatype\",\n                            icon: \"fa-exchange\",\n                            onclick: function() {\n                                self._submit(\"datatype\", form);\n                            }\n                        })\n                    }\n                });\n                return form;\n            },\n\n            /** dataset permissions form */\n            _getPermission: function() {\n                var self = this;\n                var form = new Form({\n                    title: \"Manage dataset permissions\",\n                    operations: {\n                        submit_permission: new Ui.ButtonIcon({\n                            tooltip: \"Save permissions.\",\n                            title: \"Save permissions\",\n                            icon: \"fa-floppy-o \",\n                            onclick: function() {\n                                self._submit(\"permission\", form);\n                            }\n                        })\n                    }\n                });\n                return form;\n            },\n\n            /** reload Galaxy's history after updating dataset's attributes */\n            _reloadHistory: function() {\n                if (window.Galaxy) {\n                    window.Galaxy.currHistoryPanel.loadCurrentHistory();\n                }\n            }\n        });\n\n        return {\n            View: View\n        };\n    }\n);\n"]}