{"version":3,"sources":["mvc/library/library-librarytoolbar-view.js"],"names":["define","mod_toastr","LibraryToolbarView","Backbone","View","extend","el","search_term","events","click #create_new_library_btn","click #include_deleted_chk","click #exclude_restricted_chk","click .page_size_prompt","keyup .library-search-input","initialize","options","defaults","this","render","_","is_admin","is_anonym","user","isAnonymous","toolbar_template","find","isAdmin","$el","html","admin_user","anon_user","renderPaginator","libraries","preferences","get","paginator_template","show_page","parseInt","page_count","templatePaginator","createLibraryFromModal","event","stopPropagation","self","modal","total_libraries_count","libraries_shown","closing_events","Galaxy","preventDefault","show","createNewLibrary","libraryDetails","body","validateNewLibrary","buttons","save","hide","serializeNewLibrary","mod_library_model","Library","error","success","library","libraryListView","collection","add","clearLibraryModal","showPageSizePrompt","library_page_size","prompt","response","responseJSON","set","err_msg","e","description","synopsis","$","val","includeDeletedChecked","name","searchLibraries","checked","with_deleted","excludeRestrictedChecked","target","without_restricted","templateToolBar","template","join","templateNewLibraryInModal"],"mappings":"aAAAA,QAAQ,cAAe,6BAA8B,SACjDC,EADJD,GAwTI,OACIE,mBAjT0CC,SAAAC,KAAAC,QAC1CC,GAAI,UAGAC,UAJsCA,YAAA,IAQtCC,QACAC,gCAA8B,yBAC9BC,6BAAA,wBACAC,gCAA2B,2BAC3BC,0BAAA,qBAZsCC,8BAAA,mBAgBtCC,WAAKC,SAAYC,GAKjBC,KAAKC,QAALC,EAAAH,SArBsCC,KAAAF,YAkBlCA,EAMAE,KAAAD,UAEJC,KAAIG,UAGAA,OAAAA,WACAC,IAAAA,EAAmBC,KAAKC,kBAC3BH,GAAA,EACDC,GACIG,EAEAJ,OAAAA,OACAA,EAASK,OACLH,KAAAI,UAEJL,EAASI,OACLH,KAAAC,eAxC8BN,KAAAU,IAAAC,KAiClCJ,GAAmBK,WAAYT,EAAUU,UAAWT,KAEpDD,IACAH,KAAKU,IAAIF,KAcjBM,wBACShB,GAAAA,QAAYV,OAAO2B,UAATC,YAAfC,IAAA,gBACIC,KAAAA,IAAAA,KACJ,2BAEQC,GAAAA,QAAWC,OAASL,UAAAC,YADLC,IAEfI,wBANZP,gBAAiB,SAAShB,GACtBE,KAAKF,QAAUI,EAAEd,OAAOY,KAAKF,QAASA,GACtC,IAAIoB,EAAqBlB,KAAKsB,oBAkBlCC,KAAAA,IAAAA,KAAAA,sBAAwBZ,KACpBa,GACMC,UAAAA,SAANzB,KAAAF,QAAAqB,WACIO,WAAJN,SAAApB,KAAAF,QAAAuB,YACKM,sBAAL3B,KAAAF,QAAA8B,sBACKD,gBAAW3B,KAAAF,QAAA+B,gBACZC,kBADYC,OAAAhB,UAAAC,YAAAC,IAEL,yBAFKM,uBAAhB,SAAAC,GA3EsCA,EAAAQ,iBAwEtCR,EAAMC,kBAkBV,IAAAC,EAAA1B,KAhBIA,KAAK2B,MAAQI,OAAOJ,MACpB3B,KAAK2B,MAAMM,MAkBfC,gBAAkB,EACVC,MAAAA,qBACAC,KAAKC,KAAAA,4BACLC,SACIZ,OAAO,WACHa,EAAKJ,oBAELJ,MAAAA,WAGAL,EAAKC,MAAMa,YASPxD,iBAAAA,WACH,IAAAmD,EAAAnC,KAAAyC,sBACJ,GAAAzC,KAAAqC,mBAAAF,GAAA,CAhBwB,IAkB1BT,EAAA1B,MAlBH,IAAA0C,EAAAC,SAmBA3D,KAAW4D,GACdC,QAAA,SAAAC,GACDf,OAAAhB,UAAAgC,gBAAAC,WAAAC,IAvHsCH,GA0H1CpB,EAAAC,MAAAa,OAlBgBd,EAAKwB,oBACLnB,OAAOhB,UAAUgC,gBAAgB9C,SAoBjDkD,EAAoBN,QAAA,qBAEZO,MAAAA,SAAoBC,EACpBC,QAKAF,IADAA,EAAAG,aAGOxC,EAAUC,MAAYwC,EAAID,aAAAE,SAAjCzE,EAAA4D,MAAA,6BAOR5D,EAAA4D,MAAA,8BAvBI,OAAO,GAMXO,mBAAoB,SAASO,GA0B7BA,EAAA1B,iBAxBI,IAAIoB,EAAoBC,OACpB,kDA0BRZ,OAAAA,UAAqBzB,YAAAC,IAAA,sBAGE,MAAf0C,GACAC,GAAYxC,SAAAgC,KA9JsBrB,OAAAhB,UAAAC,YAAAwC,KAwI9BJ,kBAAmBhC,SAASgC,KAEhCrB,OAAOhB,UAAUgC,gBAAgB9C,QAASkB,UAAW,MAO7D+B,kBAAmB,WACfW,EAAE,sBAAsBC,IAAI,IA0BhCC,EAAAA,6BAAuBD,IAAA,IACnBD,EAAA,0BAA0BC,IAAA,KAMzBrB,oBAAA,WAnLqC,OA4JlCuB,KAAMH,EAAE,sBAAsBC,MA0BtCH,YAAAE,EAAA,6BAAAC,MAxBQF,SAAUC,EAAE,0BAA0BC,QAgCzCzB,mBAAA,SAAAF,GACDJ,MAAiBgB,KAAVhC,EAAUgC,MAnBrBgB,sBAAuB,SAASvC,GA0BhCyC,EAAAA,OAAiBC,SACT5E,OAAAA,UAAgB0B,YAAAwC,KAAAW,cAApB,IACApC,OAAKjC,UAAQR,gBAAcA,iBAxMWyC,OAAAhB,UAAAC,YAAAwC,KAAAW,cAAA,IAkLlCpC,OAAOhB,UAAUgC,gBAAgB9C,WAmE7BmE,yBAAA,SAAA5C,GACAA,EACA6C,OAAAH,QAvP8BnC,OAAAhB,UAAAC,YAAAwC,KAAAc,oBAAA,IA4P1ChD,OAAAA,UAAmBN,YAAAwC,KAAAc,oBAAW,IAMlBvC,OAAAhB,UAAAgC,gBAAA9C,UAlQhBgE,gBAAA,SAAAzC,GAuMQ,IAAIlC,EAAcuE,EAAE,yBAAyBC,MAyG9C9D,KAAAF,QAAAR,YAAAA,EACHL,OAAAA,UAAoBA,gBAAAA,gBAAAA,IArGpBsF,gBAAiB,WACb,OAAOrE,EAAEsE,UAED,wCACA,0BACA,6BACA,yCACA,wFACA,0DAEA,UACA,wCACA,+FACA,SAEA,kCACA,4DACA,UACA,mDACA,mBACA,WACA,WACA,UACA,sDACA,qBACA,WACA,WACA,SACA,oGACA,wIACA,UACA,UACA,0GACA,gGACA,yGACA,OACA,UACA,UACA,SACA,SACA,+BAEA,SACA,UACFC,KAAK,MAIfnD,kBAAmB,WACf,OAAOpB,EAAEsE,UAED,wCACA,uCACA,gDACA,+EACA,sGACA,iBACA,+EACA,yFACA,UACA,iBACA,gGACA,sGACA,UACA,sBACA,wEACA,QACA,4CACA,yFACA,wGACA,iBACA,uGACA,yHACA,UACA,QACA,SACA,0LACA,UACA,SACA,sCACA,WACFC,KAAK,MAIfC,0BAA2B,WACvB,OAAOxE,EAAEsE,UAED,+BACA,SACA,wEACA,4EACA,sEACA,UACA,UACFC,KAAK","file":"../../../scripts/mvc/library/library-librarytoolbar-view.js","sourcesContent":["define([\"libs/toastr\", \"mvc/library/library-model\"], function(\n    mod_toastr,\n    mod_library_model\n) {\n    /**\n * This view represents the top part of the library page.\n * It contains the tool bar with controls.\n */\n    var LibraryToolbarView = Backbone.View.extend({\n        el: \"#center\",\n\n        defaults: {\n            search_term: \"\"\n        },\n\n        events: {\n            \"click #create_new_library_btn\": \"createLibraryFromModal\",\n            \"click #include_deleted_chk\": \"includeDeletedChecked\",\n            \"click #exclude_restricted_chk\": \"excludeRestrictedChecked\",\n            \"click .page_size_prompt\": \"showPageSizePrompt\",\n            \"keyup .library-search-input\": \"searchLibraries\"\n        },\n\n        initialize: function(options) {\n            this.options = _.defaults(\n                this.options || {},\n                options,\n                this.defaults\n            );\n            this.render();\n        },\n\n        render: function() {\n            var toolbar_template = this.templateToolBar();\n            var is_admin = false;\n            var is_anonym = true;\n            if (Galaxy.user) {\n                is_admin = Galaxy.user.isAdmin();\n                is_anonym = Galaxy.user.isAnonymous();\n            }\n            this.$el.html(\n                toolbar_template({ admin_user: is_admin, anon_user: is_anonym })\n            );\n            if (is_admin) {\n                this.$el.find(\n                    \"#include_deleted_chk\"\n                )[0].checked = Galaxy.libraries.preferences.get(\"with_deleted\");\n                this.$el.find(\n                    \"#exclude_restricted_chk\"\n                )[0].checked = Galaxy.libraries.preferences.get(\n                    \"without_restricted\"\n                );\n            }\n        },\n\n        /**\n   * Renders the element that shows pages into its div within the toolbar.\n   */\n        renderPaginator: function(options) {\n            this.options = _.extend(this.options, options);\n            var paginator_template = this.templatePaginator();\n            this.$el.find(\"#library_paginator\").html(\n                paginator_template({\n                    show_page: parseInt(this.options.show_page),\n                    page_count: parseInt(this.options.page_count),\n                    total_libraries_count: this.options.total_libraries_count,\n                    libraries_shown: this.options.libraries_shown,\n                    library_page_size: Galaxy.libraries.preferences.get(\n                        \"library_page_size\"\n                    )\n                })\n            );\n        },\n\n        /**\n   * User clicked on 'New library' button. Show modal to\n   * satisfy the wish.\n   */\n        createLibraryFromModal: function(event) {\n            event.preventDefault();\n            event.stopPropagation();\n            var self = this;\n            this.modal = Galaxy.modal;\n            this.modal.show({\n                closing_events: true,\n                title: \"Create New Library\",\n                body: this.templateNewLibraryInModal(),\n                buttons: {\n                    Create: function() {\n                        self.createNewLibrary();\n                    },\n                    Close: function() {\n                        self.modal.hide();\n                    }\n                }\n            });\n        },\n\n        /**\n   * Create the new library using the API asynchronously.\n   */\n        createNewLibrary: function() {\n            var libraryDetails = this.serializeNewLibrary();\n            if (this.validateNewLibrary(libraryDetails)) {\n                var library = new mod_library_model.Library();\n                var self = this;\n                library.save(libraryDetails, {\n                    success: function(library) {\n                        Galaxy.libraries.libraryListView.collection.add(\n                            library\n                        );\n                        self.modal.hide();\n                        self.clearLibraryModal();\n                        Galaxy.libraries.libraryListView.render();\n                        mod_toastr.success(\"Library created.\");\n                    },\n                    error: function(model, response) {\n                        if (typeof response.responseJSON !== \"undefined\") {\n                            mod_toastr.error(response.responseJSON.err_msg);\n                        } else {\n                            mod_toastr.error(\"An error occured.\");\n                        }\n                    }\n                });\n            } else {\n                mod_toastr.error(\"Library's name is missing.\");\n            }\n            return false;\n        },\n\n        /**\n   * Show user the propmpt to change the number of libs shown on page.\n   */\n        showPageSizePrompt: function(e) {\n            e.preventDefault();\n            var library_page_size = prompt(\n                \"How many libraries per page do you want to see?\",\n                Galaxy.libraries.preferences.get(\"library_page_size\")\n            );\n            if (\n                library_page_size != null &&\n                library_page_size == parseInt(library_page_size)\n            ) {\n                Galaxy.libraries.preferences.set({\n                    library_page_size: parseInt(library_page_size)\n                });\n                Galaxy.libraries.libraryListView.render({ show_page: 1 });\n            }\n        },\n\n        /**\n   * Clear the library modal once it is saved.\n   */\n        clearLibraryModal: function() {\n            $(\"input[name='Name']\").val(\"\");\n            $(\"input[name='Description']\").val(\"\");\n            $(\"input[name='Synopsis']\").val(\"\");\n        },\n\n        /**\n   * Prepare new library variables to be submitted to API.\n   */\n        serializeNewLibrary: function() {\n            return {\n                name: $(\"input[name='Name']\").val(),\n                description: $(\"input[name='Description']\").val(),\n                synopsis: $(\"input[name='Synopsis']\").val()\n            };\n        },\n\n        /**\n   * Check whether entered values are valid.\n   */\n        validateNewLibrary: function(libraryDetails) {\n            return libraryDetails.name !== \"\";\n        },\n\n        /**\n   * Include or exclude deleted libraries in the view.\n   */\n        includeDeletedChecked: function(event) {\n            if (event.target.checked) {\n                Galaxy.libraries.preferences.set({ with_deleted: true });\n                Galaxy.libraries.libraryListView.fetchDeleted();\n            } else {\n                Galaxy.libraries.preferences.set({ with_deleted: false });\n                Galaxy.libraries.libraryListView.render();\n            }\n        },\n\n        /**\n   * Include or exclude restricted libraries in the view.\n   */\n        excludeRestrictedChecked: function(event) {\n            if (event.target.checked) {\n                Galaxy.libraries.preferences.set({ without_restricted: true });\n            } else {\n                Galaxy.libraries.preferences.set({ without_restricted: false });\n            }\n            Galaxy.libraries.libraryListView.render();\n        },\n\n        /**\n   * Take the contents of the search field and send it to the list view\n   * to query the collection of libraries.\n   */\n        searchLibraries: function(event) {\n            var search_term = $(\".library-search-input\").val();\n            this.options.search_term = search_term;\n            Galaxy.libraries.libraryListView.searchLibraries(search_term);\n        },\n\n        templateToolBar: function() {\n            return _.template(\n                [\n                    '<div class=\"library_style_container\">',\n                    '<div id=\"toolbar_form\">',\n                    '<div id=\"library_toolbar\">',\n                    '<form class=\"form-inline\" role=\"form\">',\n                    '<span><strong><a href=\"#\" title=\"Go to first page\">DATA LIBRARIES</a></strong></span>',\n                    '<span id=\"library_paginator\" class=\"library-paginator\">',\n                    // paginator will append here\n                    \"</span>\",\n                    '<div class=\"form-group toolbar-item\">',\n                    '<input type=\"text\" class=\"form-control library-search-input\" placeholder=\"Search\" size=\"30\">',\n                    \"</div>\",\n                    // only admins see the following\n                    \"<% if(admin_user === true) { %>\",\n                    '<div class=\"checkbox toolbar-item\" style=\"height: 20px;\">',\n                    \"<label>\",\n                    '<input id=\"include_deleted_chk\" type=\"checkbox\">',\n                    \"include deleted \",\n                    \"</input>\",\n                    \"</label>\",\n                    \"<label>\",\n                    '<input id=\"exclude_restricted_chk\" type=\"checkbox\">',\n                    \"exclude restricted\",\n                    \"</input>\",\n                    \"</label>\",\n                    \"</div>\",\n                    '<span class=\"toolbar-item\" data-toggle=\"tooltip\" data-placement=\"top\" title=\"Create New Library\">',\n                    '<button id=\"create_new_library_btn\" class=\"primary-button btn-xs\" type=\"button\"><span class=\"fa fa-plus\"></span> New Library</button>',\n                    \"</span>\",\n                    \"<% } %>\",\n                    '<span class=\"help-button\" data-toggle=\"tooltip\" data-placement=\"top\" title=\"See this screen annotated\">',\n                    '<a href=\"https://galaxyproject.org/data-libraries/screen/list-of-libraries/\" target=\"_blank\">',\n                    '<button class=\"primary-button\" type=\"button\"><span class=\"fa fa-question-circle\"></span> Help</button>',\n                    \"</a>\",\n                    \"</span>\",\n                    \"</form>\",\n                    \"</div>\",\n                    \"</div>\",\n                    '<div id=\"libraries_element\">',\n                    // table with libraries will append here\n                    \"</div>\",\n                    \"</div>\"\n                ].join(\"\")\n            );\n        },\n\n        templatePaginator: function() {\n            return _.template(\n                [\n                    '<ul class=\"pagination pagination-sm\">',\n                    \"<% if ( ( show_page - 1 ) > 0 ) { %>\",\n                    \"<% if ( ( show_page - 1 ) > page_count ) { %>\", // we are on higher page than total page count\n                    '<li><a href=\"#page/1\"><span class=\"fa fa-angle-double-left\"></span></a></li>',\n                    '<li class=\"disabled\"><a href=\"#page/<% print( show_page ) %>\"><% print( show_page - 1 ) %></a></li>',\n                    \"<% } else { %>\",\n                    '<li><a href=\"#page/1\"><span class=\"fa fa-angle-double-left\"></span></a></li>',\n                    '<li><a href=\"#page/<% print( show_page - 1 ) %>\"><% print( show_page - 1 ) %></a></li>',\n                    \"<% } %>\",\n                    \"<% } else { %>\", // we are on the first page\n                    '<li class=\"disabled\"><a href=\"#page/1\"><span class=\"fa fa-angle-double-left\"></span></a></li>',\n                    '<li class=\"disabled\"><a href=\"#page/<% print( show_page ) %>\"><% print( show_page - 1 ) %></a></li>',\n                    \"<% } %>\",\n                    '<li class=\"active\">',\n                    '<a href=\"#page/<% print( show_page ) %>\"><% print( show_page ) %></a>',\n                    \"</li>\",\n                    \"<% if ( ( show_page ) < page_count ) { %>\",\n                    '<li><a href=\"#page/<% print( show_page + 1 ) %>\"><% print( show_page + 1 ) %></a></li>',\n                    '<li><a href=\"#page/<% print( page_count ) %>\"><span class=\"fa fa-angle-double-right\"></span></a></li>',\n                    \"<% } else { %>\",\n                    '<li class=\"disabled\"><a href=\"#page/<% print( show_page  ) %>\"><% print( show_page + 1 ) %></a></li>',\n                    '<li class=\"disabled\"><a href=\"#page/<% print( page_count ) %>\"><span class=\"fa fa-angle-double-right\"></span></a></li>',\n                    \"<% } %>\",\n                    \"</ul>\",\n                    \"<span>\",\n                    ' <%- libraries_shown %> libraries shown <a href=\"\" data-toggle=\"tooltip\" data-placement=\"top\" title=\"currently <%- library_page_size %> per page\" class=\"page_size_prompt\">(change)</a>',\n                    \"</span>\",\n                    \"<span>\",\n                    \" <%- total_libraries_count %> total\",\n                    \"</span>\"\n                ].join(\"\")\n            );\n        },\n\n        templateNewLibraryInModal: function() {\n            return _.template(\n                [\n                    '<div id=\"new_library_modal\">',\n                    \"<form>\",\n                    '<input type=\"text\" name=\"Name\" value=\"\" placeholder=\"Name\" autofocus>',\n                    '<input type=\"text\" name=\"Description\" value=\"\" placeholder=\"Description\">',\n                    '<input type=\"text\" name=\"Synopsis\" value=\"\" placeholder=\"Synopsis\">',\n                    \"</form>\",\n                    \"</div>\"\n                ].join(\"\")\n            );\n        }\n    });\n\n    return {\n        LibraryToolbarView: LibraryToolbarView\n    };\n});\n"]}