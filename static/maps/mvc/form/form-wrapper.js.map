{"version":3,"sources":["mvc/form/form-wrapper.js"],"names":["define","Form","Ui","View","Backbone","extend","initialize","options","Model","this","model","get","url","redirect","render","self","root","ajax","type","response","attributes","$","form","title","message","status","icon","inputs","buttons","Button","tooltip","submit_tooltip","submit_title","cls","onclick","_submit","$el","empty","append","fail","Message","persistent","Galaxy","data","JSON","contentType","done","stringify","create","success_message","window","location","field_list","_showMessage","matchModel","input_id","value","input","first","animate","scrollTop","responseJSON","err_msg","parents","filter","indexOf","css","update"],"mappings":"aACAA,QAAQ,qBAAsB,kBAAmB,SAASC,EAAMC,GAwG5D,OACIC,KA1GRC,SAAAD,KAAAE,QACQC,WAAA,SAADC,GACCJ,KAAOC,MAASD,IAAKE,SAAOG,MAAAD,GAC5BD,KAAAA,IAAYG,KAAAC,MAAAC,IAAA,OACRF,KAAKC,SAAQD,KAAIL,MAASI,IAAb,YACbC,KAAKG,WAAWF,UAChBD,KAAKI,UAGRC,OAP2B,WAUxB,IAAIC,EAAON,KADfK,EAAAA,MACQC,IAAAA,OAAJC,KAAAP,KAAAG,IACEK,KAAK,QAEHC,KAAM,SAAAC,GAEA,IAAAZ,EAASY,EAAAA,UAAUJ,EAAAL,MAAAU,WAAAD,GACjBZ,EAAUc,IAAEhB,GACZiB,MAAWrB,EAAKsB,MAChBA,QAAOhB,EADSiB,QAEhBA,OAASjB,EAAQiB,QAFD,UAGhBC,KAAQlB,EAAQkB,KAChBC,OAAMnB,EAJUoB,OAKhBA,SACAC,OAAS,IAAA1B,EAAA2B,QACGC,QAAOD,EAAOE,eAClBD,MAASvB,EAAQwB,cADC,OAElBR,KAAOhB,EAAQyB,aAAgB,UAC/BN,IAAMnB,iCACN0B,QAAK,WACLC,EAASC,QAAAb,SAZrBP,EAAAqB,IAAAC,QAAAC,OAAAhB,EAAAc,OAoBHG,KAAK,SAASpB,GACXJ,EAASsB,IAAAA,QAAQC,OAETd,IAAAA,EACIgB,SACIhB,QACI,2BAAAT,EAAAH,IAAA,IALpBa,OAAA,SA3BRgB,YAAA,IAXwBL,QAoDpBxB,QAAAA,SAAK8B,GACLC,IAAAA,EAAMC,KACN1B,EAAAA,MACA2B,IAAAA,OAAAA,KAAa9B,EAAAH,IAEZkC,KAAKF,KAAAG,UAAS5B,EAAUwB,KAAAK,UACrB9B,KAAI+B,MACAzB,YAASL,qBAETsB,KAAAA,SAAAA,GAHJ,IAAAQ,GAKIlC,QAAJI,EAAmBK,QACf0B,OAAOC,UAKJV,YAAA,GAKCnB,EAAK8B,SAJTF,OAAAC,SAMKE,OAAAA,KACRtC,EAAAF,SAEC,IACGwC,EAAAA,MAAa/B,IAEdG,EAAQkB,KAAAW,WAFYnC,EAAA,SAGpBsB,EAHJc,GAhFgBjC,EAAA8B,WAAAG,GAAAC,MAAAC,EAAAD,SAwFdzC,EAAAsC,aAAA/B,EAAA2B,MASLS,KARL,SAAAvC,GASOwC,EAAAA,aAAUC,GACjBpC,QAAoBjB,EAApBsD,aAAAC,QACHrC,OAAA,SApGLgB,YAAA,OADJY,aAAA,SAAA/B,EAAAf,GA0FyBe,EAAKc,IACb2B,UACAC,OAAO,WACJ,OAEK,IADA,OAAQ,UAAUC,QAAQ5C,EAAEZ,MAAMyD,IAAI,eAI9CR,QACEC,SAAUC,UAAW,GAAK,KACjCtC,EAAKE,QAAQ2C,OAAO5D","file":"../../../scripts/mvc/form/form-wrapper.js","sourcesContent":["/** Generic form view */\ndefine([\"mvc/form/form-view\", \"mvc/ui/ui-misc\"], function(Form, Ui) {\n    var View = Backbone.View.extend({\n        initialize: function(options) {\n            this.model = new Backbone.Model(options);\n            this.url = this.model.get(\"url\");\n            this.redirect = this.model.get(\"redirect\");\n            this.setElement(\"<div/>\");\n            this.render();\n        },\n\n        render: function() {\n            var self = this;\n            $.ajax({\n                url: Galaxy.root + this.url,\n                type: \"GET\"\n            })\n                .done(function(response) {\n                    var options = $.extend({}, self.model.attributes, response);\n                    var form = new Form({\n                        title: options.title,\n                        message: options.message,\n                        status: options.status || \"warning\",\n                        icon: options.icon,\n                        inputs: options.inputs,\n                        buttons: {\n                            submit: new Ui.Button({\n                                tooltip: options.submit_tooltip,\n                                title: options.submit_title || \"Save\",\n                                icon: options.submit_icon || \"fa-save\",\n                                cls: \"btn btn-primary ui-clear-float\",\n                                onclick: function() {\n                                    self._submit(form);\n                                }\n                            })\n                        }\n                    });\n                    self.$el.empty().append(form.$el);\n                })\n                .fail(function(response) {\n                    self.$el.empty().append(\n                        new Ui.Message({\n                            message:\n                                \"Failed to load resource \" + self.url + \".\",\n                            status: \"danger\",\n                            persistent: true\n                        }).$el\n                    );\n                });\n        },\n\n        _submit: function(form) {\n            var self = this;\n            $.ajax({\n                url: Galaxy.root + self.url,\n                data: JSON.stringify(form.data.create()),\n                type: \"PUT\",\n                contentType: \"application/json\"\n            })\n                .done(function(response) {\n                    var success_message = {\n                        message: response.message,\n                        status: \"success\",\n                        persistent: false\n                    };\n                    if (self.redirect) {\n                        window.location =\n                            Galaxy.root +\n                            self.redirect +\n                            \"?\" +\n                            $.param(success_message);\n                    } else {\n                        form.data.matchModel(response, function(\n                            input,\n                            input_id\n                        ) {\n                            form.field_list[input_id].value(input.value);\n                        });\n                        self._showMessage(form, success_message);\n                    }\n                })\n                .fail(function(response) {\n                    self._showMessage(form, {\n                        message: response.responseJSON.err_msg,\n                        status: \"danger\",\n                        persistent: false\n                    });\n                });\n        },\n\n        _showMessage: function(form, options) {\n            var $panel = form.$el\n                .parents()\n                .filter(function() {\n                    return (\n                        [\"auto\", \"scroll\"].indexOf($(this).css(\"overflow\")) !=\n                        -1\n                    );\n                })\n                .first();\n            $panel.animate({ scrollTop: 0 }, 500);\n            form.message.update(options);\n        }\n    });\n\n    return {\n        View: View\n    };\n});\n"]}