{"version":3,"sources":["layout/menu.js"],"names":["define","Collection","model","defaults","target","Webhooks","_l","Utils","Backbone","extend","Model","self","options","fetch","extendedNavItem","GenericNav","GenericNavView","this","add","render","id","title","url","tooltip","disabled","Galaxy","user","menu","webhook","obj","$","document","ready","masthead","collection","toJSON","activate","appendScriptStyle","icon","config","onclick","function","Function","page","cls","support_url","terms_url","helpTab","search_url","biostar_url","mailing_lists","screencasts_url","biostar_url_redirect","wiki_url","citation_url","allow_user_creation","noscratchbook","userTab","View","_template","get","session_csrf_token","divider","_formatUrl","show","hide","$menu","menuItem","active_view","activeView","set","addClass","resolve","promise","Tab","initialize","_buildMenuItem","events","e","frame","$el","attr","css","visibility","_toggleClick","preventDefault","trigger","display","removeClass","buildLink","$toggle","popover","html","placement","content","setTimeout","off","on","_","each","append","m","label","root","attributes","indexOf","charAt"],"mappings":"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","file":"../../scripts/layout/menu.js","sourcesContent":["/** Masthead Collection **/\ndefine(\n    [\n        \"layout/generic-nav-view\",\n        \"mvc/webhooks\",\n        \"utils/localization\",\n        \"utils/utils\"\n    ],\n    function(GenericNav, Webhooks, _l, Utils) {\n        var Collection = Backbone.Collection.extend({\n            model: Backbone.Model.extend({\n                defaults: {\n                    visible: true,\n                    target: \"_parent\"\n                }\n            }),\n            fetch: function(options) {\n                var self = this;\n                options = options || {};\n                this.reset();\n\n                //\n                // Chat server tab\n                //\n                var extendedNavItem = new GenericNav.GenericNavView();\n                this.add(extendedNavItem.render());\n\n                //\n                // Analyze data tab.\n                //\n                this.add({\n                    id: \"analysis\",\n                    title: _l(\"Analyze Data\"),\n                    url: \"\",\n                    tooltip: _l(\"Analysis home view\")\n                });\n\n                //\n                // Workflow tab.\n                //\n                this.add({\n                    id: \"workflow\",\n                    title: _l(\"Workflow\"),\n                    tooltip: _l(\"Chain tools into workflows\"),\n                    disabled: !Galaxy.user.id,\n                    url: \"workflow\"\n                });\n\n                //\n                // 'Shared Items' or Libraries tab.\n                //\n                this.add({\n                    id: \"shared\",\n                    title: _l(\"Shared Data\"),\n                    url: \"library/index\",\n                    tooltip: _l(\"Access published resources\"),\n                    menu: [\n                        {\n                            title: _l(\"Data Libraries\"),\n                            url: \"library/list\"\n                        },\n                        {\n                            title: _l(\"Histories\"),\n                            url: \"histories/list_published\"\n                        },\n                        {\n                            title: _l(\"Workflows\"),\n                            url: \"workflows/list_published\"\n                        },\n                        {\n                            title: _l(\"Visualizations\"),\n                            url: \"visualizations/list_published\"\n                        },\n                        {\n                            title: _l(\"Pages\"),\n                            url: \"pages/list_published\"\n                        }\n                    ]\n                });\n\n                //\n                // Visualization tab.\n                //\n                this.add({\n                    id: \"visualization\",\n                    title: _l(\"Visualization\"),\n                    url: \"visualizations/list\",\n                    tooltip: _l(\"Visualize datasets\"),\n                    disabled: !Galaxy.user.id,\n                    menu: [\n                        {\n                            title: _l(\"New Track Browser\"),\n                            url: \"visualization/trackster\",\n                            target: \"_frame\"\n                        },\n                        {\n                            title: _l(\"Saved Visualizations\"),\n                            url: \"visualizations/list\",\n                            target: \"_frame\"\n                        },\n                        {\n                            title: _l(\"Interactive Environments\"),\n                            url: \"visualization/gie_list\",\n                            target: \"galaxy_main\"\n                        }\n                    ]\n                });\n\n                //\n                // Webhooks\n                //\n                Webhooks.add({\n                    url: \"api/webhooks/masthead/all\",\n                    callback: function(webhooks) {\n                        $(document).ready(function() {\n                            $.each(webhooks.models, function(index, model) {\n                                var webhook = model.toJSON();\n                                if (webhook.activate) {\n                                    var obj = {\n                                        id: webhook.name,\n                                        icon: webhook.config.icon,\n                                        url: webhook.config.url,\n                                        tooltip: webhook.config.tooltip,\n                                        onclick:\n                                            webhook.config.function &&\n                                            new Function(\n                                                webhook.config.function\n                                            )\n                                    };\n\n                                    // Galaxy.page is undefined for data libraries, workflows pages\n                                    if (Galaxy.page) {\n                                        Galaxy.page.masthead.collection.add(\n                                            obj\n                                        );\n                                    } else if (Galaxy.masthead) {\n                                        Galaxy.masthead.collection.add(obj);\n                                    }\n\n                                    // Append masthead script and styles to Galaxy main\n                                    Utils.appendScriptStyle(webhook);\n                                }\n                            });\n                        });\n                    }\n                });\n\n                //\n                // Admin.\n                //\n                Galaxy.user.get(\"is_admin\") &&\n                    this.add({\n                        id: \"admin\",\n                        title: _l(\"Admin\"),\n                        url: \"admin\",\n                        tooltip: _l(\"Administer this Galaxy\"),\n                        cls: \"admin-only\"\n                    });\n\n                //\n                // Help tab.\n                //\n                var helpTab = {\n                    id: \"help\",\n                    title: _l(\"Help\"),\n                    tooltip: _l(\"Support, contact, and community\"),\n                    menu: [\n                        {\n                            title: _l(\"Support\"),\n                            url: options.support_url,\n                            target: \"_blank\"\n                        },\n                        {\n                            title: _l(\"Search\"),\n                            url: options.search_url,\n                            target: \"_blank\"\n                        },\n                        {\n                            title: _l(\"Mailing Lists\"),\n                            url: options.mailing_lists,\n                            target: \"_blank\"\n                        },\n                        {\n                            title: _l(\"Videos\"),\n                            url: options.screencasts_url,\n                            target: \"_blank\"\n                        },\n                        {\n                            title: _l(\"Wiki\"),\n                            url: options.wiki_url,\n                            target: \"_blank\"\n                        },\n                        {\n                            title: _l(\"How to Cite Galaxy\"),\n                            url: options.citation_url,\n                            target: \"_blank\"\n                        },\n                        {\n                            title: _l(\"Interactive Tours\"),\n                            url: \"tours\"\n                        }\n                    ]\n                };\n                options.terms_url &&\n                    helpTab.menu.push({\n                        title: _l(\"Terms and Conditions\"),\n                        url: options.terms_url,\n                        target: \"_blank\"\n                    });\n                options.biostar_url &&\n                    helpTab.menu.unshift({\n                        title: _l(\"Ask a question\"),\n                        url: \"biostar/biostar_question_redirect\",\n                        target: \"_blank\"\n                    });\n                options.biostar_url &&\n                    helpTab.menu.unshift({\n                        title: _l(\"Galaxy Biostar\"),\n                        url: options.biostar_url_redirect,\n                        target: \"_blank\"\n                    });\n                this.add(helpTab);\n\n                //\n                // User tab.\n                //\n                var userTab = {};\n                if (!Galaxy.user.id) {\n                    if (options.allow_user_creation) {\n                        userTab = {\n                            id: \"user\",\n                            title: _l(\"Login or Register\"),\n                            cls: \"loggedout-only\",\n                            tooltip: _l(\"Account registration or login\"),\n                            menu: [\n                                {\n                                    title: _l(\"Login\"),\n                                    url: \"user/login\",\n                                    target: \"galaxy_main\",\n                                    noscratchbook: true\n                                },\n                                {\n                                    title: _l(\"Register\"),\n                                    url: \"user/create\",\n                                    target: \"galaxy_main\",\n                                    noscratchbook: true\n                                }\n                            ]\n                        };\n                    } else {\n                        userTab = {\n                            id: \"user\",\n                            title: _l(\"Login\"),\n                            cls: \"loggedout-only\",\n                            tooltip: _l(\"Login\"),\n                            url: \"user/login\",\n                            target: \"galaxy_main\",\n                            noscratchbook: true\n                        };\n                    }\n                } else {\n                    userTab = {\n                        id: \"user\",\n                        title: _l(\"User\"),\n                        cls: \"loggedin-only\",\n                        tooltip: _l(\"Account and saved data\"),\n                        menu: [\n                            {\n                                title:\n                                    _l(\"Logged in as\") +\n                                    \" \" +\n                                    Galaxy.user.get(\"email\")\n                            },\n                            {\n                                title: _l(\"Preferences\"),\n                                url: \"user\"\n                            },\n                            {\n                                title: _l(\"Custom Builds\"),\n                                url: \"custom_builds\"\n                            },\n                            {\n                                title: _l(\"Logout\"),\n                                url:\n                                    \"user/logout?session_csrf_token=\" +\n                                    Galaxy.session_csrf_token,\n                                target: \"_top\",\n                                divider: true\n                            },\n                            {\n                                title: _l(\"Saved Histories\"),\n                                url: \"histories/list\",\n                                target: \"_top\"\n                            },\n                            {\n                                title: _l(\"Saved Datasets\"),\n                                url: \"datasets/list\",\n                                target: \"_top\"\n                            },\n                            {\n                                title: _l(\"Saved Pages\"),\n                                url: \"pages/list\",\n                                target: \"_top\"\n                            }\n                        ]\n                    };\n                }\n                this.add(userTab);\n                var activeView = this.get(options.active_view);\n                activeView && activeView.set(\"active\", true);\n                return new jQuery.Deferred().resolve().promise();\n            }\n        });\n\n        /** Masthead tab **/\n        var Tab = Backbone.View.extend({\n            initialize: function(options) {\n                this.model = options.model;\n                this.setElement(this._template());\n                this.$dropdown = this.$(\".dropdown\");\n                this.$toggle = this.$(\".dropdown-toggle\");\n                this.$menu = this.$(\".dropdown-menu\");\n                this.$note = this.$(\".dropdown-note\");\n                this.listenTo(this.model, \"change\", this.render, this);\n            },\n\n            events: {\n                \"click .dropdown-toggle\": \"_toggleClick\"\n            },\n\n            render: function() {\n                var self = this;\n                $(\".tooltip\").remove();\n                this.$el.attr(\"id\", this.model.id).css({\n                    visibility:\n                        (this.model.get(\"visible\") && \"visible\") || \"hidden\"\n                });\n                this.model.set(\"url\", this._formatUrl(this.model.get(\"url\")));\n                this.$note\n                    .html(this.model.get(\"note\") || \"\")\n                    .removeClass()\n                    .addClass(\"dropdown-note\")\n                    .addClass(this.model.get(\"note_cls\"))\n                    .css({\n                        display:\n                            (this.model.get(\"show_note\") && \"block\") || \"none\"\n                    });\n                this.$toggle\n                    .html(this.model.get(\"title\") || \"\")\n                    .removeClass()\n                    .addClass(\"dropdown-toggle\")\n                    .addClass(this.model.get(\"cls\"))\n                    .addClass(\n                        this.model.get(\"icon\") &&\n                            \"dropdown-icon fa \" + this.model.get(\"icon\")\n                    )\n                    .addClass(this.model.get(\"toggle\") && \"toggle\")\n                    .attr(\"target\", this.model.get(\"target\"))\n                    .attr(\"href\", this.model.get(\"url\"))\n                    .attr(\"title\", this.model.get(\"tooltip\"))\n                    .tooltip(\"destroy\");\n                this.model.get(\"tooltip\") &&\n                    this.$toggle.tooltip({ placement: \"bottom\" });\n                this.$dropdown\n                    .removeClass()\n                    .addClass(\"dropdown\")\n                    .addClass(this.model.get(\"disabled\") && \"disabled\")\n                    .addClass(this.model.get(\"active\") && \"active\");\n                if (this.model.get(\"menu\") && this.model.get(\"show_menu\")) {\n                    this.$menu.show();\n                    $(\"#dd-helper\")\n                        .show()\n                        .off()\n                        .on(\"click\", function() {\n                            $(\"#dd-helper\").hide();\n                            self.model.set(\"show_menu\", false);\n                        });\n                } else {\n                    self.$menu.hide();\n                    $(\"#dd-helper\").hide();\n                }\n                this.$menu.empty().removeClass(\"dropdown-menu\");\n                if (this.model.get(\"menu\")) {\n                    _.each(this.model.get(\"menu\"), function(menuItem) {\n                        self.$menu.append(self._buildMenuItem(menuItem));\n                        menuItem.divider &&\n                            self.$menu.append($(\"<li/>\").addClass(\"divider\"));\n                    });\n                    self.$menu.addClass(\"dropdown-menu\");\n                    self.$toggle.append($(\"<b/>\").addClass(\"caret\"));\n                }\n                return this;\n            },\n\n            /** Add new menu item */\n            _buildMenuItem: function(options) {\n                var self = this;\n                options = _.defaults(options || {}, {\n                    title: \"\",\n                    url: \"\",\n                    target: \"_parent\",\n                    noscratchbook: false\n                });\n                options.url = self._formatUrl(options.url);\n                return $(\"<li/>\").append(\n                    $(\"<a/>\")\n                        .attr(\"href\", options.url)\n                        .attr(\"target\", options.target)\n                        .html(options.title)\n                        .on(\"click\", function(e) {\n                            e.preventDefault();\n                            self.model.set(\"show_menu\", false);\n                            if (options.onclick) {\n                                options.onclick();\n                            } else {\n                                Galaxy.frame.add(options);\n                            }\n                        })\n                );\n            },\n\n            /** Handle click event */\n            _toggleClick: function(e) {\n                var self = this;\n                var model = this.model;\n                e.preventDefault();\n                $(\".tooltip\").hide();\n                model.trigger(\"dispatch\", function(m) {\n                    model.id !== m.id &&\n                        m.get(\"menu\") &&\n                        m.set(\"show_menu\", false);\n                });\n                if (!model.get(\"disabled\")) {\n                    if (!model.get(\"menu\")) {\n                        model.get(\"onclick\")\n                            ? model.get(\"onclick\")()\n                            : Galaxy.frame.add(model.attributes);\n                    } else {\n                        model.set(\"show_menu\", true);\n                    }\n                } else {\n                    function buildLink(label, url) {\n                        return $(\"<div/>\")\n                            .append(\n                                $(\"<a/>\")\n                                    .attr(\"href\", Galaxy.root + url)\n                                    .html(label)\n                            )\n                            .html();\n                    }\n                    this.$toggle.popover && this.$toggle.popover(\"destroy\");\n                    this.$toggle\n                        .popover({\n                            html: true,\n                            placement: \"bottom\",\n                            content:\n                                \"Please \" +\n                                buildLink(\n                                    \"login\",\n                                    \"user/login?use_panels=True\"\n                                ) +\n                                \" or \" +\n                                buildLink(\n                                    \"register\",\n                                    \"user/create?use_panels=True\"\n                                ) +\n                                \" to use this feature.\"\n                        })\n                        .popover(\"show\");\n                    setTimeout(function() {\n                        self.$toggle.popover(\"destroy\");\n                    }, 5000);\n                }\n            },\n\n            /** Url formatting */\n            _formatUrl: function(url) {\n                return typeof url == \"string\" &&\n                    url.indexOf(\"//\") === -1 &&\n                    url.charAt(0) != \"/\"\n                    ? Galaxy.root + url\n                    : url;\n            },\n\n            /** body tempate */\n            _template: function() {\n                return (\n                    '<ul class=\"nav navbar-nav\">' +\n                    '<li class=\"dropdown\">' +\n                    '<a class=\"dropdown-toggle\"/>' +\n                    '<ul class=\"dropdown-menu\"/>' +\n                    '<div class=\"dropdown-note\"/>' +\n                    \"</li>\" +\n                    \"</ul>\"\n                );\n            }\n        });\n\n        return {\n            Collection: Collection,\n            Tab: Tab\n        };\n    }\n);\n"]}