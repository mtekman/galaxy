{"version":3,"sources":["layout/panel.js"],"names":["define","$","Backbone","MIN_PANEL_WIDTH","MAX_PANEL_WIDTH","SidePanel","view","options","initialize","hidden","this","saved_size","hiddenByTool","$center","$el","siblings","$toggleButton","render","panel","components","html","each","buttons","model","attributes","self","_templatePanel","append","_","button","addClass","cls","escape","title","_templateHeader","_templateFooter","join","data","events","_templateBody","_mousedownDragHandler","prevX","oldWidth","newWidth","mousedown .unified-panel-footer > .drag","ev","css","e","pageX","width","draggingLeft","delta","Math","min","animation","whichSide","id","show","on","move","one","off","resize","animate","newSize","toggle","handle_minwidth_hint","space","hint","hide","force_panel","op","toString","RightPanel","CenterPanel","$panel","_iframeChangeHandler","iframe","currentTarget","location","Galaxy","search","hash","LeftPanel","extend","contentWindow","onbeforeunload","View","template","$frame","bind","host","trigger","fullpath","pathname","display","message","confirm","undefined","attr","empty","scrollTop"],"mappings":"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","file":"../../scripts/layout/panel.js","sourcesContent":["define([\"jquery\", \"libs/underscore\", \"libs/backbone\"], function(\n    $,\n    _,\n    Backbone\n) {\n    \"use strict\";\n\n    var MIN_PANEL_WIDTH = 160,\n        MAX_PANEL_WIDTH = 800;\n\n    /** View for left/right panels used by Page view */\n    var SidePanel = Backbone.View.extend({\n        initialize: function(options) {\n            this.view = options.view;\n            this.hidden = false;\n            this.saved_size = null;\n            this.hiddenByTool = false;\n        },\n\n        $center: function() {\n            return this.$el.siblings(\"#center\");\n        },\n\n        $toggleButton: function() {\n            return this.$(\".unified-panel-footer > .panel-collapse\");\n        },\n\n        render: function() {\n            var self = this;\n            var panel = this.view;\n            var components = this.view.model.attributes || {};\n            this.$el.html(this._templatePanel(this.id));\n            _.each(components.buttons, function(button) {\n                self.$(\".panel-header-buttons\").append(button.$el);\n            });\n            this.$el.addClass(components.cls);\n            this.$(\".panel-header-text\").html(_.escape(components.title));\n            this.$(\".unified-panel-body\").append(panel.$el);\n            panel.render();\n        },\n\n        /** panel dom template. id is 'right' or 'left' */\n        _templatePanel: function() {\n            return [\n                this._templateHeader(),\n                this._templateBody(),\n                this._templateFooter()\n            ].join(\"\");\n        },\n\n        /** panel dom template. id is 'right' or 'left' */\n        _templateHeader: function(data) {\n            return [\n                '<div class=\"unified-panel-header\" unselectable=\"on\">',\n                '<div class=\"unified-panel-header-inner\">',\n                '<div class=\"panel-header-buttons\" style=\"float: right\"/>',\n                '<div class=\"panel-header-text\"/>',\n                \"</div>\",\n                \"</div>\"\n            ].join(\"\");\n        },\n\n        /** panel dom template. id is 'right' or 'left' */\n        _templateBody: function(data) {\n            return '<div class=\"unified-panel-body\"/>';\n        },\n\n        /** panel dom template. id is 'right' or 'left' */\n        _templateFooter: function(data) {\n            return [\n                '<div class=\"unified-panel-footer\">',\n                '<div class=\"panel-collapse ',\n                _.escape(this.id),\n                '\"/>',\n                '<div class=\"drag\"/>',\n                \"</div>\"\n            ].join(\"\");\n        },\n\n        events: {\n            \"mousedown .unified-panel-footer > .drag\": \"_mousedownDragHandler\",\n            \"click .unified-panel-footer > .panel-collapse\": \"toggle\"\n        },\n\n        _mousedownDragHandler: function(ev) {\n            var self = this,\n                draggingLeft = this.id === \"left\",\n                prevX = ev.pageX;\n\n            function move(e) {\n                var delta = e.pageX - prevX;\n                prevX = e.pageX;\n                var oldWidth = self.$el.width(),\n                    newWidth = draggingLeft\n                        ? oldWidth + delta\n                        : oldWidth - delta;\n                // Limit range\n                newWidth = Math.min(\n                    MAX_PANEL_WIDTH,\n                    Math.max(MIN_PANEL_WIDTH, newWidth)\n                );\n                self.resize(newWidth);\n            }\n\n            // this is a page wide overlay that assists in capturing the move and release of the mouse\n            // if not provided, progress and end wouldn't fire if the mouse moved out of the drag button area\n            $(\"#dd-helper\")\n                .show()\n                .on(\"mousemove\", move)\n                .one(\"mouseup\", function(e) {\n                    $(this)\n                        .hide()\n                        .off(\"mousemove\", move);\n                });\n        },\n\n        // TODO: the following three could be simplified I think\n        // if panel is 'right' (this.id), move center right newSize number of pixels\n        resize: function(newSize) {\n            this.$el.css(\"width\", newSize);\n            this.$center().css(this.id, newSize);\n            return this;\n        },\n\n        show: function() {\n            if (!this.hidden) {\n                return;\n            }\n            var self = this,\n                animation = {},\n                whichSide = this.id;\n            animation[whichSide] = 0;\n            self.$el\n                .css(whichSide, -this.saved_size)\n                .show()\n                .animate(animation, \"fast\", function() {\n                    self.resize(self.saved_size);\n                });\n            self.hidden = false;\n            self.$toggleButton().removeClass(\"hidden\");\n            return this;\n        },\n\n        hide: function() {\n            if (this.hidden) {\n                return;\n            }\n            var animation = {},\n                whichSide = this.id;\n            this.saved_size = this.$el.width();\n            animation[whichSide] = -this.saved_size;\n            this.$el.animate(animation, \"fast\");\n            this.$center().css(whichSide, 0);\n            this.hidden = true;\n            this.$toggleButton().addClass(\"hidden\");\n            return this;\n        },\n\n        toggle: function(ev) {\n            this.hidden ? this.show() : this.hide();\n            this.hiddenByTool = false;\n            return this;\n        },\n\n        // ..............................................................\n        //TODO: only used in message.mako?\n        /**   */\n        handle_minwidth_hint: function(hint) {\n            var space =\n                this.$center().width() - (this.hidden ? this.saved_size : 0);\n            if (space < hint) {\n                if (!this.hidden) {\n                    this.toggle();\n                    this.hiddenByTool = true;\n                }\n            } else {\n                if (this.hiddenByTool) {\n                    this.toggle();\n                    this.hiddenByTool = false;\n                }\n            }\n            return self;\n        },\n\n        /**   */\n        force_panel: function(op) {\n            if (op == \"show\") {\n                return this.show();\n            }\n            if (op == \"hide\") {\n                return this.hide();\n            }\n            return self;\n        },\n\n        toString: function() {\n            return \"SidePanel(\" + this.id + \")\";\n        }\n    });\n\n    // ----------------------------------------------------------------------------\n    // TODO: side should be defined by page - not here\n    var LeftPanel = SidePanel.extend({\n        id: \"left\"\n    });\n\n    var RightPanel = SidePanel.extend({\n        id: \"right\"\n    });\n\n    /** Center panel with the ability to switch between iframe and view */\n    var CenterPanel = Backbone.View.extend({\n        initialize: function(options) {\n            this.setElement($(this.template()));\n            this.$frame = this.$(\".center-frame\");\n            this.$panel = this.$(\".center-panel\");\n            this.$frame.on(\"load\", _.bind(this._iframeChangeHandler, this));\n        },\n\n        /** Display iframe if its target url changes, hide center panel */\n        _iframeChangeHandler: function(ev) {\n            var iframe = ev.currentTarget;\n            var location =\n                iframe.contentWindow && iframe.contentWindow.location;\n            if (location && location.host) {\n                $(iframe).show();\n                this.$panel.empty().hide();\n                Galaxy.trigger(\"center-frame:load\", {\n                    fullpath:\n                        location.pathname + location.search + location.hash,\n                    pathname: location.pathname,\n                    search: location.search,\n                    hash: location.hash\n                });\n            }\n        },\n\n        /** Display a view in the center panel, hide iframe */\n        display: function(view) {\n            var contentWindow = this.$frame[0].contentWindow || {};\n            var message =\n                contentWindow.onbeforeunload && contentWindow.onbeforeunload();\n            if (!message || confirm(message)) {\n                contentWindow.onbeforeunload = undefined;\n                this.$frame.attr(\"src\", \"about:blank\").hide();\n                this.$panel\n                    .empty()\n                    .scrollTop(0)\n                    .append(view.$el)\n                    .show();\n                Galaxy.trigger(\"center-panel:load\", view);\n            }\n        },\n\n        template: function() {\n            return (\n                '<div class=\"center-container\">' +\n                '<iframe id=\"galaxy_main\" name=\"galaxy_main\" frameborder=\"0\" class=\"center-frame\" />' +\n                '<div class=\"center-panel\" />' +\n                \"</div>\"\n            );\n        },\n\n        toString: function() {\n            return \"CenterPanel\";\n        }\n    });\n\n    return {\n        SidePanel: SidePanel,\n        LeftPanel: LeftPanel,\n        RightPanel: RightPanel,\n        CenterPanel: CenterPanel\n    };\n});\n"]}