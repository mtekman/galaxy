{"version":3,"sources":["layout/modal.js"],"names":["define","jQuery","buttons","extra_buttons","$","options","this","$overlay","overlay","$dialog","dialog","Modal","$header","$footer","find","proxy","hide","extend","setContent","title","html","show","$buttons","name","value","append","click","$extraButtons","each","text","body","$backdrop","$body","callback","is","backdrop","addClass","removeClass","modal","css","width","window","height","outerHeight","parseInt","fadeOut","hide_modal","children","remove","undefined","show_modal","init_fn","show_in_overlay","scroll","show_message","closeButton","unbind","url"],"mappings":"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","file":"../../scripts/layout/modal.js","sourcesContent":["define([\"jquery\"], function(jQuery) {\n    \"use strict\";\n    // ============================================================================\n    //TODO: (the older version) unify with ui-modal (the newer version)\n    var $ = jQuery;\n\n    // Modal dialog boxes\n    var Modal = function(options) {\n        this.$overlay = options.overlay;\n        this.$dialog = options.dialog;\n        this.$header = this.$dialog.find(\".modal-header\");\n        this.$body = this.$dialog.find(\".modal-body\");\n        this.$footer = this.$dialog.find(\".modal-footer\");\n        this.$backdrop = options.backdrop;\n        // Close button\n        this.$header.find(\".close\").on(\"click\", $.proxy(this.hide, this));\n    };\n\n    $.extend(Modal.prototype, {\n        setContent: function(options) {\n            this.$header.hide();\n            // Title\n            if (options.title) {\n                this.$header.find(\".title\").html(options.title);\n                this.$header.show();\n            }\n            if (options.closeButton) {\n                this.$header.find(\".close\").show();\n                this.$header.show();\n            } else {\n                this.$header.find(\".close\").hide();\n            }\n            // Buttons\n            this.$footer.hide();\n            var $buttons = this.$footer.find(\".buttons\").html(\"\");\n            if (options.buttons) {\n                $.each(options.buttons, function(name, value) {\n                    $buttons\n                        .append(\n                            $(\"<button></button> \")\n                                .text(name)\n                                .click(value)\n                        )\n                        .append(\" \");\n                });\n                this.$footer.show();\n            }\n            var $extraButtons = this.$footer.find(\".extra_buttons\").html(\"\");\n            if (options.extra_buttons) {\n                $.each(options.extra_buttons, function(name, value) {\n                    $extraButtons\n                        .append(\n                            $(\"<button></button>\")\n                                .text(name)\n                                .click(value)\n                        )\n                        .append(\" \");\n                });\n                this.$footer.show();\n            }\n            // Body\n            var body = options.body;\n            if (body == \"progress\") {\n                body = $(\n                    \"<div class='progress progress-striped active'><div class='progress-bar' style='width: 100%'></div></div>\"\n                );\n            }\n            this.$body.html(body);\n        },\n        show: function(options, callback) {\n            if (!this.$dialog.is(\":visible\")) {\n                if (options.backdrop) {\n                    this.$backdrop.addClass(\"in\");\n                } else {\n                    this.$backdrop.removeClass(\"in\");\n                }\n                this.$overlay.show();\n                this.$dialog.show();\n                this.$overlay.addClass(\"in\");\n                // Fix min-width so that modal cannot shrink considerably if new content is loaded.\n                this.$body.css(\"min-width\", this.$body.width());\n                // Set max-height so that modal does not exceed window size and is in middle of page.\n                // TODO: this could perhaps be handled better using CSS.\n                this.$body.css(\n                    \"max-height\",\n                    $(window).height() -\n                        this.$footer.outerHeight() -\n                        this.$header.outerHeight() -\n                        parseInt(this.$dialog.css(\"padding-top\"), 10) -\n                        parseInt(this.$dialog.css(\"padding-bottom\"), 10)\n                );\n            }\n            // Callback on init\n            if (callback) {\n                callback();\n            }\n        },\n        hide: function() {\n            var modal = this;\n            modal.$dialog.fadeOut(function() {\n                modal.$overlay.hide();\n                modal.$backdrop.removeClass(\"in\");\n                modal.$body.children().remove();\n                // Clear min-width to allow for modal to take size of new body.\n                modal.$body.css(\"min-width\", undefined);\n            });\n        }\n    });\n\n    var modal;\n\n    $(function() {\n        modal = new Modal({\n            overlay: $(\"#top-modal\"),\n            dialog: $(\"#top-modal-dialog\"),\n            backdrop: $(\"#top-modal-backdrop\")\n        });\n    });\n\n    // Backward compatibility\n    function hide_modal() {\n        modal.hide();\n    }\n\n    function show_modal(title, body, buttons, extra_buttons, init_fn) {\n        modal.setContent({\n            title: title,\n            body: body,\n            buttons: buttons,\n            extra_buttons: extra_buttons\n        });\n        modal.show({ backdrop: true }, init_fn);\n    }\n\n    function show_message(title, body, buttons, extra_buttons, init_fn) {\n        modal.setContent({\n            title: title,\n            body: body,\n            buttons: buttons,\n            extra_buttons: extra_buttons\n        });\n        modal.show({ backdrop: false }, init_fn);\n    }\n\n    function show_in_overlay(options) {\n        var width = options.width || \"600\";\n        var height = options.height || \"400\";\n        var scroll = options.scroll || \"auto\";\n        $(\"#overlay-background\").bind(\"click.overlay\", function() {\n            hide_modal();\n            $(\"#overlay-background\").unbind(\"click.overlay\");\n        });\n        modal.setContent({\n            closeButton: true,\n            title: \"&nbsp;\",\n            body: $(\n                \"<div style='margin: -5px;'><iframe style='margin: 0; padding: 0;' src='\" +\n                    options.url +\n                    \"' width='\" +\n                    width +\n                    \"' height='\" +\n                    height +\n                    \"' scrolling='\" +\n                    scroll +\n                    \"' frameborder='0'></iframe></div>\"\n            )\n        });\n        modal.show({ backdrop: true });\n    }\n\n    // ============================================================================\n    return {\n        Modal: Modal,\n        hide_modal: hide_modal,\n        show_modal: show_modal,\n        show_message: show_message,\n        show_in_overlay: show_in_overlay\n    };\n});\n"]}