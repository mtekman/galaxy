"use strict";define(["libs/underscore","libs/backbone","utils/add-logging","utils/localization"],function(e,t,i,s){var n={logger:null,_logNamespace:"."};i(n);var r=t.Model.extend({initialize:function(t){if(this._checkEnabledSessionStorage(),!t.id)throw new Error("SessionStorageModel requires an id in the initial attributes");this.id=t.id;var i=this.isNew()?{}:this._read(this);this.clear({silent:!0}),this.save(e.extend({},this.defaults,i,t),{silent:!0}),this.on("change",function(){this.save()})},_checkEnabledSessionStorage:function(){try{return window.sessionStorage.length>=0}catch(e){return alert("Please enable cookies in your browser for this Galaxy site"),!1}},sync:function(e,t,i){i.silent||t.trigger("request",t,{},i);var s={};switch(e){case"create":s=this._create(t);break;case"read":s=this._read(t);break;case"update":s=this._update(t);break;case"delete":s=this._delete(t)}return void 0!==s||null!==s?i.success&&i.success():i.error&&i.error(),s},_create:function(e){try{var t=e.toJSON(),i=sessionStorage.setItem(e.id,JSON.stringify(t));return null===i?i:t}catch(e){if(!(e instanceof DOMException&&navigator.userAgent.indexOf("Safari")>-1))throw e}return null},_read:function(e){return JSON.parse(sessionStorage.getItem(e.id))},_update:function(e){return e._create(e)},_delete:function(e){return sessionStorage.removeItem(e.id)},isNew:function(){return!sessionStorage.hasOwnProperty(this.id)},_log:function(){return JSON.stringify(this.toJSON(),null,"  ")},toString:function(){return"SessionStorageModel("+this.id+")"}});return r.prototype=e.omit(r.prototype,"url","urlRoot"),{LoggableMixin:n,SessionStorageModel:r,mixin:function(t,i){var s=Array.prototype.slice.call(arguments,0),n=s.pop();return s.unshift(n),e.defaults.apply(e,s)},SearchableModelMixin:{searchAttributes:[],searchAliases:{},searchAttribute:function(t,i){var s=this.get(t);return!(!i||void 0===s||null===s)&&(e.isArray(s)?this._searchArrayAttribute(s,i):-1!==s.toString().toLowerCase().indexOf(i.toLowerCase()))},_searchArrayAttribute:function(t,i){return i=i.toLowerCase(),e.any(t,function(e){return-1!==e.toString().toLowerCase().indexOf(i.toLowerCase())})},search:function(t){var i=this;return e.filter(this.searchAttributes,function(e){return i.searchAttribute(e,t)})},matches:function(e){var t=e.split("=");if(t.length>=2){var i=t[0];return i=this.searchAliases[i]||i,this.searchAttribute(i,t[1])}return!!this.search(e).length},matchesAll:function(t){var i=this;return t=t.match(/(".*"|\w*=".*"|\S*)/g).filter(function(e){return!!e}),e.all(t,function(e){return e=e.replace(/"/g,""),i.matches(e)})}},HiddenUntilActivatedViewMixin:{hiddenUntilActivated:function(t,i){if(i=i||{},this.HUAVOptions={$elementShown:this.$el,showFn:jQuery.prototype.toggle,showSpeed:"fast"},e.extend(this.HUAVOptions,i||{}),this.HUAVOptions.hasBeenShown=this.HUAVOptions.$elementShown.is(":visible"),this.hidden=this.isHidden(),t){var s=this;t.on("click",function(e){s.toggle(s.HUAVOptions.showSpeed)})}},isHidden:function(){return this.HUAVOptions.$elementShown.is(":hidden")},toggle:function(){return this.hidden?(this.HUAVOptions.hasBeenShown||e.isFunction(this.HUAVOptions.onshowFirstTime)&&(this.HUAVOptions.hasBeenShown=!0,this.HUAVOptions.onshowFirstTime.call(this)),e.isFunction(this.HUAVOptions.onshow)&&(this.HUAVOptions.onshow.call(this),this.trigger("hiddenUntilActivated:shown",this)),this.hidden=!1):(e.isFunction(this.HUAVOptions.onhide)&&(this.HUAVOptions.onhide.call(this),this.trigger("hiddenUntilActivated:hidden",this)),this.hidden=!0),this.HUAVOptions.showFn.apply(this.HUAVOptions.$elementShown,arguments)}},DraggableViewMixin:{initialize:function(e){this.draggable=e.draggable||!1},$dragHandle:function(){return this.$(".title-bar")},toggleDraggable:function(){this.draggable?this.draggableOff():this.draggableOn()},draggableOn:function(){this.draggable=!0,this.dragStartHandler=e.bind(this._dragStartHandler,this),this.dragEndHandler=e.bind(this._dragEndHandler,this);var t=this.$dragHandle().attr("draggable",!0).get(0);t.addEventListener("dragstart",this.dragStartHandler,!1),t.addEventListener("dragend",this.dragEndHandler,!1)},draggableOff:function(){this.draggable=!1;var e=this.$dragHandle().attr("draggable",!1).get(0);e.removeEventListener("dragstart",this.dragStartHandler,!1),e.removeEventListener("dragend",this.dragEndHandler,!1)},_dragStartHandler:function(e){return e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text",JSON.stringify(this.model.toJSON())),this.trigger("draggable:dragstart",e,this),!1},_dragEndHandler:function(e){return this.trigger("draggable:dragend",e,this),!1}},SelectableViewMixin:{initialize:function(e){this.selectable=e.selectable||!1,this.selected=e.selected||!1},$selector:function(){return this.$(".selector")},_renderSelected:function(){this.$selector().find("span").toggleClass("fa-check-square-o",this.selected).toggleClass("fa-square-o",!this.selected)},toggleSelector:function(){this.$selector().is(":visible")?this.hideSelector():this.showSelector()},showSelector:function(e){e=void 0!==e?e:this.fxSpeed,this.selectable=!0,this.trigger("selectable",!0,this),this._renderSelected(),e?this.$selector().show(e):this.$selector().show()},hideSelector:function(e){e=void 0!==e?e:this.fxSpeed,this.selectable=!1,this.trigger("selectable",!1,this),e?this.$selector().hide(e):this.$selector().hide()},toggleSelect:function(e){this.selected?this.deselect(e):this.select(e)},select:function(e){return this.selected||(this.trigger("selected",this,e),this.selected=!0,this._renderSelected()),!1},deselect:function(e){return this.selected&&(this.trigger("de-selected",this,e),this.selected=!1,this._renderSelected()),!1}},wrapTemplate:function(t,i){i=i||"model";var n=e.template(t.join(""));return function(e,t){var r={view:t||{},_l:s};return r[i]=e||{},n(r)}},buildComparator:function(e,t){var i=(t=t||{}).ascending?1:-1;return function(t,s){return t=t.get(e),s=s.get(e),(t<s?-1:t>s?1:0)*i}}}});
//# sourceMappingURL=../../maps/mvc/base-mvc.js.map
