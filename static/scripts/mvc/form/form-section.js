"use strict";define(["utils/utils","mvc/ui/ui-misc","mvc/ui/ui-portlet","mvc/form/form-repeat","mvc/form/form-input","mvc/form/form-parameters"],function(e,i,a,t,n,s){var d=Backbone.View.extend({initialize:function(e,i){this.app=e,this.inputs=i.inputs,this.parameters=new s,this.setElement($("<div/>")),this.render()},render:function(){var e=this;this.$el.empty(),_.each(this.inputs,function(i){e.add(i)})},add:function(i){var a=jQuery.extend(!0,{},i);switch(a.id=i.id=e.uid(),this.app.input_list[a.id]=a,a.type){case"conditional":this._addConditional(a);break;case"repeat":this._addRepeat(a);break;case"section":this._addSection(a);break;default:this._addRow(a)}},_addConditional:function(e){var i=this;e.test_param.id=e.id,this.app.model.get("sustain_conditionals")&&(e.test_param.disabled=!0);var a=this._addRow(e.test_param);a.model&&a.model.set("onchange",function(a){var t=i.app.data.matchCase(e,a);for(var n in e.cases){var s=e.cases[n],d=i.$("#"+e.id+"-section-"+n),p=!1;for(var l in s.inputs)if(!s.inputs[l].hidden){p=!0;break}n==t&&p?d.fadeIn("fast"):d.hide()}i.app.trigger("change")});for(var t in e.cases){var n=new d(this.app,{inputs:e.cases[t].inputs});this._append(n.$el.addClass("ui-form-section"),e.id+"-section-"+t)}a.trigger("change")},_addRepeat:function(e){function i(i){var t=e.id+"-section-"+s++,n=new d(a.app,{inputs:i});p.add({id:t,$el:n.$el,ondel:function(){p.del(t),a.app.trigger("change")}})}for(var a=this,s=0,p=new t.View({title:e.title||"Repeat",min:e.min,max:e.max,onnew:function(){i(e.inputs),a.app.trigger("change")}}),l=_.size(e.cache),r=0;r<Math.max(Math.max(l,e.min||0),e.default||0);r++)i(r<l?e.cache[r]:e.inputs);this.app.model.get("sustain_repeats")&&p.hideOptions();var o=new n(this.app,{label:e.title||e.name,help:e.help,field:p});this._append(o.$el,e.id)},_addSection:function(e){var i=new a.View({title:e.title||e.name,cls:"ui-portlet-section",collapsible:!0,collapsible_button:!0,collapsed:!e.expanded});i.append(new d(this.app,{inputs:e.inputs}).$el),i.append($("<div/>").addClass("ui-form-info").html(e.help)),this.app.on("expand",function(e){i.$("#"+e).length>0&&i.expand()}),this._append(i.$el,e.id)},_addRow:function(e){var i=this,a=e.id;e.onchange=e.onchange||function(){i.app.trigger("change",a)};var t=this.parameters.create(e);this.app.field_list[a]=t;var s=new n(this.app,{name:e.name,label:e.hide_label?"":e.label||e.name,value:e.value,text_value:e.text_value,collapsible_value:e.collapsible_value,collapsible_preview:e.collapsible_preview,help:e.help,argument:e.argument,disabled:e.disabled,color:e.color,style:e.style,backdrop:e.backdrop,hidden:e.hidden,fixed:e.fixed,field:t});return this.app.element_list[a]=s,this._append(s.$el,e.id),t},_append:function(e,i){this.$el.append(e.addClass("section-row").attr("id",i))}});return{View:d}});
//# sourceMappingURL=../../../maps/mvc/form/form-section.js.map
