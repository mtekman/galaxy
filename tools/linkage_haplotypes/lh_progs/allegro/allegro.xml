
<tool id="allegro_1" name="Allegro" version="0.1.0" >
    <description>Linkage and Haplotype analysis</description>
    <command>./allegro $allegro_conf</command>

    <configfiles>
      <configfile name="allegro_conf" >
	PREFILE "${inp_ped}"
	DATFILE "${inp_dat}"

	"${analysis_type}"
	MAXMEMORY 1200
      </configfile>
    </configfiles>

    
    <inputs>
      <!-- Have to add this format to the list of expected types -->
      <param name="inp_ped" type="data" format="linkage_pedin"  label="Pedigree" />
      <param name="inp_dat" type="data" format="linkage_recomb" label="Recombination Freqs." />
      <param name="inp_map" type="data" format="linkage_map"    label="Marker Positions" optional="true" />

      <param name="analysis_type" type="select" multiple="true" label="Analysis Type" >
	<option value="\nMODEL mpt par het" selected="true" >Linkage Analysis</option>
	<option value="\nHAPLOTYPES" selected="true" >Haplotype Analysis</option>
      </param>

      <conditional name="advanced_options" >
	<param name="extra_options" type="select" label="Advanced Options" >
	  <option value="default" selected="true" >Use Defaults</option>
	  <option value="extra" >Expand Advanced Options</option>
	</param>

	<when value="extra">
	  <param name="maxmemory"     type="integer" value="1200"  label="Max Memory (Mb)" />
	  <param name="crossover"     type="boolean" value="false" label="Calculate Crossover Rate" />
	  <param name="uninformative" type="boolean" value="false" label="Log Uninormative markers" />
	  <param name="entropy"       type="boolean" value="false" label="Calculate Entropy" />
	  <param name="maxsteplength" type="float"   value="1"     label="Max Interval (cM) between calculations" />
	  <param name="nplexactp"     type="boolean" value="false" label="Use exact P-values" />
	</when>
	<when value="default">
	</when>
      </conditional>
    </inputs>

    <outputs>
     <data name="Haplotypes"   format="allegro_haplo"   label="Allegro Haplotypes File"  />
     <data name="Linkage" format="allegro_linkage" label="Allegro MPT Linkage File" />
     <data name="Descent" format="allegro_descent" label="Allegro Descent File"     />
    </outputs>
    <!-- TEST -->

    <tests>
      <test>
	<param name="inp_ped" value="pedin.22" />
	<param name="inp_dat" value="datain.22" />
	<param name="analysis_type" value="MODEL mpt par het\nHAPLOTYPES"  />
	<output name="Haplotypes"   ftype="allegro_haplo" />
	<output name="Linkage" ftype="allegro_linkage" />
	<output name="Descent" ftype="alegro_descent" />
      </test>
    </tests>

    <help>
      This tool computes linkage anaysis and/or haplotype analysis for a set of input linkage files
    </help>

</tool>
